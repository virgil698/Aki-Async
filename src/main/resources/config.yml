# ==========================================
# AkiAsync 配置文件 / Configuration File
# ==========================================
# 配置版本 / Configuration version
version: 20

# 语言设置 / Language Setting
# 可选值 / Available options: zh_CN (中文), en_US (English)
# 语言文件位于 plugins/AkiAsync/language/ 目录
# Language files are located in plugins/AkiAsync/language/ directory
language: zh_CN

# ==========================================
# 统一线程池配置 / Unified Thread Pool Configuration
# ==========================================
# 所有异步任务统一使用此线程池配置 / All async tasks use this unified thread pool configuration
# 0 = 自动分配（CPU核心数/4，最小2）/ Auto-allocate (CPU cores/4, min 2)
# >0 = 手动指定线程数 / Manually specify thread count
general-thread-pool:
  size: 0  # 统一线程池大小 / Unified thread pool size

# ==========================================
# 实体系统优化 / Entity System Optimization
# ==========================================

# 多线程实体追踪器 / Multithreaded Entity Tracker
# 多线程并行处理实体追踪，大幅降低MSPT（10-30%） / Multi-threaded parallel entity tracking, significantly reduces MSPT (10-30%)
entity-tracker:
  enabled: true  # 启用多线程实体追踪器 / Enable multithreaded entity tracker

# 异步生物生成 / Async Mob Spawning
# 异步处理自然生成逻辑，避免阻塞主线程
# Async natural spawning logic to avoid blocking main thread
mob-spawning:
  enabled: true
  spawner-optimization: true  # 优化刷怪笼性能 / Optimize spawner performance
  spawn-interval: 3  # 生成频率 / Spawn frequency (1=每tick / every tick, 2=每2tick / every 2 ticks, 3=每3tick 推荐 / recommended)

# 实体密度控制 / Entity Density Control
# 限制单区块实体数量，防止实体过多导致卡顿
# Limit entities per chunk to prevent lag from entity overflow
density:
  enabled: true
  max-per-chunk: 60  # 单区块最大实体数 / Max entities per chunk (降低以减少卡顿 / reduced to minimize lag)

# AI降频 / Brain Throttle
# 静止实体降低AI更新频率，节省CPU资源
# Reduce AI update rate for stationary mobs to save CPU
# UniversalAI会自动感知降频状态 / UniversalAI auto-respects throttle state
brain:
  enabled: true
  throttle-interval: 15  # 降频间隔 / Throttle interval (静止实体每N tick更新 / stationary mobs update every N ticks, 提高以节省更多CPU / increased to save more CPU)

# 窒息优化 / Suffocation Optimization
# 仅在实体能受伤时检测窒息，减少不必要的检测
# Only check suffocation when entity can take damage
suffocation-optimization:
  enabled: true

# 抛射物优化 / Projectile Optimization
# 限制抛射物加载区块，防止抛射物导致的卡顿
# Limit chunk loading by projectiles to prevent lag
projectile:
  enabled: true
  max-loads-per-tick: 10  # 每tick最多加载区块数 / Max chunks loaded per tick (推荐 / Recommended: 8-15)
  max-loads-per-projectile: 10  # 每个抛射物生命周期最多加载区块数 / Max chunks loaded per projectile lifetime (推荐 / Recommended: 8-15)

# 虚拟实体兼容性 / Virtual Entity Compatibility
# 支持FancyNpcs、ZNPCsPlus等虚拟实体插件 / Support for FancyNpcs, ZNPCsPlus and other virtual entity plugins
# 影响范围：实体包节流、掉落物优化、下落方块优化等 / Affects: entity packet throttle, item entity optimizations, falling block optimizations, etc.
# ⚠️ 禁用后虚拟实体插件可能无法正常显示 / May break virtual entity plugins when disabled
virtual-entity-compatibility:
  enabled: true  # 启用虚拟实体兼容 / Enable virtual entity compatibility
  bypass-packet-queue: true  # 虚拟实体包绕过队列直发 / Bypass queue for virtual entity packets
  exclude-from-throttling: true  # 从所有节流优化中排除 / Exclude from all throttling optimizations
  
  plugins:
    fancynpcs:
      enabled: true  # 识别FancyNpcs的NPC / Identify FancyNpcs NPCs
      use-api: true  # 使用API检测 / Use API detection
      priority: 90  # 检测优先级 / Detection priority
    
    znpcsplus:
      enabled: true  # 识别ZNPCsPlus的NPC / Identify ZNPCsPlus NPCs
      use-api: false  # 使用名称前缀检测 / Use name prefix detection
      priority: 90  # 检测优先级 / Detection priority

# 实体碰撞优化 / Entity Collision Optimization
# 针对密集实体环境的高性能碰撞检测优化
# High-performance collision detection for dense entity scenarios
# 性能提升 / Performance gain: 40-60%
collision-optimization:
  enabled: true
  exclusion-list-file: "entities.yml"  # 排除列表配置文件 / Exclusion list config file
  
  # 原生碰撞检测 / Native Collision Detection (推荐!)
  # 使用堆外内存 + AVX SIMD 向量化
  # Uses off-heap memory + AVX SIMD vectorization
  # 要求 / Requires: JDK 17+ with --add-modules jdk.incubator.vector
  native:
    enabled: true  # 启用原生碰撞检测 / Enable native collision detection
    fallback-enabled: true  # 不支持时降级到普通逻辑 / Fallback to vanilla if not supported
  
  # 基础碰撞优化 / Basic Collision Optimization
  # 保留的基础优化：跳过静止实体、Paper配置检查等
  # Preserved basic optimizations: skip static entities, Paper config checks, etc.
  aggressive-mode: true  # 激进模式 / Aggressive mode (跳过更多检查 / skip more checks)
  
  # 方块缓存 / Block Cache
  # 缓存碰撞检测中的方块状态查询，性能提升 10-15%
  # Cache block state queries in collision detection, 10-15% boost
  block-cache:
    enabled: true
    cache-size: 512  # 缓存大小 / Cache size (推荐 / Recommended: 256-1024)
    expire-ticks: 600  # 过期时间 / Expire time (ticks, 600 = 30秒 / 30 seconds)
  
  # Nitori/Lithium 实体优化 / Nitori/Lithium Entity Optimizations
  # 来源 / Source: Nitori Fabric mod
  nitori-entity-optimizations:
    mob-sunburn-optimization:  # 生物日光燃烧优化 / Mob Sunburn Optimization (缓存BlockPos，提前检查亮度 / Cache BlockPos, early brightness check)
      enabled: true
    entity-speed-optimization:  # 实体速度优化 / Entity Speed Optimization (缓存方块速度因子 / Cache block speed factor)
      enabled: true
    entity-fall-damage-optimization:  # 实体掉落伤害优化 / Entity Fall Damage Optimization (跳过简单实体的掉落伤害计算 / Skip fall damage for simple entities)
      enabled: true
    entity-section-storage-optimization:  # 实体区段快速检索优化 / Entity Section Storage Optimization (小区域使用直接哈希查找 / Use direct hash lookup for small areas)
      enabled: true
  
  # 射线碰撞检测 / Ray Collision Detection
  # DDA 算法优化射线追踪，性能提升 50-70%
  # DDA algorithm for ray tracing, 50-70% boost
  ray-collision:
    enabled: true
    max-distance: 64.0  # 最大检测距离 / Max detection distance (blocks)
  
  # 形状优化 / Shape Optimization
  # 预计算和缓存碰撞形状，减少对象分配
  # Precompute and cache collision shapes to reduce object allocation
  shape-optimization:
    enabled: true
    precompute-arrays: true  # 预计算形状数组 / Precompute shape arrays
    block-shape-cache: true  # 方块形状缓存 / Block shape cache (2-3x更快 / 2-3x faster)
    cache-size: 512  # 缓存大小 / Cache size (推荐 / Recommended: 512-2048)

# 实体移动优化 / Living Entity Travel Optimization
# 降低实体移动计算频率，减少CPU占用
# Reduce entity movement calculation frequency to save CPU
living-entity-travel-optimization:
  enabled: true
  skip-interval: 2  # 每N个tick处理一次移动 / Process movement every N ticks

# 生物消失检查优化 / Mob Despawn Check Optimization
# 降低生物消失检查频率，减少不必要的计算
# Reduce mob despawn check frequency to avoid unnecessary calculations
mob-despawn-optimization:
  enabled: true
  check-interval: 40  # 消失检查间隔 / Despawn check interval (ticks, 提高以减少检查频率 / increased to reduce check frequency)

# 并行实体Tick / Parallel Entity Tick
# 多线程并行处理实体tick，充分利用多核CPU
# Multi-threaded parallel entity ticking to utilize multi-core CPUs
# 线程数由 general-thread-pool.size 统一控制
# Thread count controlled by general-thread-pool.size
entity-tick-parallel:
  enabled: true
  min-entities: 50  # 低于此值不启用并行 / Skip parallel below threshold
  batch-size: 8  # 批量大小 / Batch size (每批处理的实体数 / entities per batch)

# 实体节流 / Entity Throttling
# 根据配置文件对特定实体类型进行节流
# Throttle specific entity types based on config file
# ⚠️ 谨慎启用，可能影响游戏机制 / Enable with caution, may affect game mechanics
entity-throttling:
  enabled: false
  config-file: "throttling.yml"  # 节流配置文件 / Throttling config file
  check-interval: 100  # 检查间隔 / Check interval (每N tick检查一次 / check every N ticks)
  throttle-interval: 3  # 节流间隔 / Throttle interval (超限后每N tick更新 / update every N ticks when exceeded)
  removal-batch-size: 10  # 移除批量大小 / Removal batch size (每次最多移除N个 / remove at most N per check)

# ==========================================
# 异步AI / Async AI
# ==========================================
# 注意：已移除旧的Brain系统异步优化，改用并行实体Tick方案
# Note: Old Brain async optimizations removed, using parallel entity tick approach instead
# 参见 entity-tick-parallel 配置 / See entity-tick-parallel config
async-ai:
  
  # 异步寻路 / Async Pathfinding
  # 将寻路计算移至异步线程，避免阻塞主线程
  # Move pathfinding calculations to async threads to avoid blocking main thread
  async-pathfinding:
    enabled: true
    keep-alive-seconds: 60  # 线程存活时间 / Thread keep-alive time
    max-queue-size: 500  # 最大队列大小 / Max queue size (推荐 / Recommended: 500-1000)
    timeout-ms: 100  # 寻路超时时间 / Pathfinding timeout (毫秒 / milliseconds)
    sync-fallback-enabled: true  # 同步降级 / Sync fallback (异步失败时使用同步寻路 / use sync when async fails)
    
    # 增强寻路系统 / Enhanced Pathfinding System
    # 优先级队列+多层缓存+路径预热，全方位提升寻路性能
    # Priority queue + multi-layer cache + path prewarming for comprehensive pathfinding boost
    enhanced:
      enabled: true
      max-concurrent-requests: 30  # 最大并发请求 / Max concurrent requests
      max-requests-per-tick: 15  # 每tick最多处理的新请求 / Max new requests per tick
      
      # 优先级配置 / Priority Configuration
      priority:
        high-distance: 16  # 高优先级距离 / High priority distance
        medium-distance: 48  # 中优先级距离 / Medium priority distance
      
      # 多层缓存配置 / Multi-Layer Cache Configuration
      cache:
        hot-size: 150  # 热缓存容量 / Hot cache size
        warm-size: 400  # 温缓存容量 / Warm cache size
        cold-size: 800  # 冷缓存容量 / Cold cache size
        hot-expire-seconds: 10
        warm-expire-seconds: 30
        cold-expire-seconds: 60
        similarity-tolerance: 3
      
      # 预热配置 / Prewarm Configuration
      prewarm:
        enabled: true
        radius: 32
        max-mobs-per-batch: 5
        max-pois-per-mob: 3
        batch-delay-ms: 100
        total-time-seconds: 5
  
  # AI传感器优化 / AI Sensor Optimization
  # 延长视线缓存清空间隔，减少昂贵的射线追踪计算
  # Extend line-of-sight cache clear interval to save expensive raytrace calculations
  sensor-optimization:
    enabled: true
    sensing-refresh-interval: 5  # 缓存清空间隔 / Cache clear interval (ticks)
  
  # 游戏事件系统优化 / Game Event System Optimization
  # 提前过滤不关心的事件，减少 Sculk Sensor 等的处理开销
  # Early filter irrelevant events to reduce Sculk Sensor processing overhead
  game-event-optimization:
    enabled: true
    early-filter: true
    throttle-low-priority: true
    throttle-interval-ms: 50
    distance-filter: true
    max-detection-distance: 64.0
  
  # 村民优化 / Villager Optimization
  villager-optimization:
    fast-raytrace:
      enabled: true
      cache-size: 256
    
    breed-optimization:
      async-villager-breed: true
      age-throttle: true
      check-interval: 5

# ==========================================
# VMP优化套件 / VMP Optimizations
# ==========================================
vmp-optimizations:
  # 区块加载优化 / Chunk Loading Optimization
  # 限制每玩家并发加载数，防止大量玩家同时传送导致卡顿
  # Limit concurrent loads per player to prevent lag from mass teleports
  chunk-loading:
    enabled: true
    max-concurrent-per-player: 5  # 每玩家最大并发区块加载 / Max concurrent chunk loads per player
  
  # 实体追踪优化 / Entity Tracking Optimization
  # 减少实体追踪范围以降低网络和CPU开销
  # Reduce tracking range to lower network and CPU overhead
  entity-tracking:
    enabled: true
    range-multiplier: 0.8  # 追踪范围倍数 / Tracking range multiplier (0.8=原版80% / 80% of vanilla)

# ==========================================
# 掉落物优化 / Item Entity Optimizations
# ==========================================
item-entity-optimizations:
  # 智能合并 / Smart Merge
  # 智能合并附近掉落物，减少实体数量
  # Intelligently merge nearby items to reduce entity count
  # 性能提升 / Performance gain: 60-80%, 降低2-4ms MSPT / 2-4ms MSPT reduction
  smart-merge:
    enabled: true
    cancel-vanilla-merge: true  # 取消原版合并 / Cancel vanilla merge (避免重复 / avoid duplication)
    merge-interval: 5  # 合并间隔 / Merge interval (推荐 / Recommended: 5-10)
    min-nearby-items: 3  # 最少附近物品数 / Min nearby items (推荐 / Recommended: 3-5)
    merge-range: 1.5  # 合并范围 / Merge range (推荐 / Recommended: 1.5-2.5)
  
  # 年龄优化 / Age Optimization
  # 静止物品降低tick频率，大幅节省性能
  # Reduce tick rate for stationary items, significant performance savings
  # 性能提升 / Performance gain: 80-90%, 降低3-5ms MSPT / 3-5ms MSPT reduction
  age-optimization:
    enabled: true
    age-interval: 10  # 年龄间隔 / Age interval (推荐 / Recommended: 10-20)
    player-detection-range: 8.0  # 玩家检测范围 / Player detection range (推荐 / Recommended: 8.0-16.0)
  
  # Inactive Tick优化 / Inactive Tick
  # 远离玩家的掉落物使用简化tick
  # Use simplified tick for items far from players
  # 性能提升 / Performance gain: 30-50%
  inactive-tick:
    enabled: true
    inactive-range: 32.0  # 不活跃范围 / Inactive range (超过此距离使用简化tick / use simplified tick beyond this)
    merge-interval: 100  # 简化tick中的合并间隔 / Merge interval in simplified tick

# 经验球优化 / Experience Orb Optimizations
# 远离玩家的经验球使用简化tick，节省性能
# Use simplified tick for experience orbs far from players to save performance
experience-orb-optimizations:
  inactive-tick:
    enabled: true
    inactive-range: 32.0  # 不活跃范围 / Inactive range
    merge-interval: 100  # 合并间隔 / Merge interval

# ==========================================
# 方块实体优化 / Block Entity Optimizations
# ==========================================
block-entity-optimizations:
  # 零延迟工厂优化 / Zero-Delay Factory
  # 将方块实体tick延迟降至0，提升工厂效率
  # Reduce block entity tick delay to 0 to boost factory efficiency
  # 支持 / Supports: Furnace/Hopper/Chest/Barrel (见entities.yml / see entities.yml)
  zero-delay-factory-optimization:
    enabled: true
    entities-config-file: "entities.yml"  # 与universal-ai共用 / Shared with universal-ai
  
  # 并行tick / Parallel Tick
  # 多线程并行处理方块实体tick
  # Multi-threaded parallel block entity ticking
  # C3H6N6O6设计，Folia下自动禁用 / C3H6N6O6 design, auto-disabled on Folia
  parallel-tick:
    enabled: true
    min-block-entities: 50  # 低于此值不并行 / Skip parallel below threshold
    batch-size: 16  # 批量大小 / Batch size (每批处理的方块实体数 / block entities per batch)
    protect-containers: true  # 容器保护 / Container protection (容器主线程执行防物品丢失 / containers on main thread to prevent item loss)
    timeout-ms: 50  # 超时时间 / Timeout (超时降级同步 / fallback to sync on timeout)
  
  # 漏斗容器缓存 / Hopper Container Cache
  # 缓存容器查询结果，减少重复查询
  # Cache container queries to reduce repeated lookups
  hopper-optimization:
    enabled: true
    cache-expire-time: 100  # 缓存过期时间 / Cache expiration (毫秒 / milliseconds)
    container-cache: true  # 容器缓存 / Container cache
    skip-failed-transfers: true  # 跳过失败的传输尝试 / Skip failed transfer attempts
    fast-empty-full-check: true  # 快速空满检测 / Fast empty/full check
  
  # 矿车tick优化 / Minecart Tick Optimization
  # 降低矿车tick频率，节省性能
  # Reduce minecart tick frequency to save performance
  minecart-optimization:
    enabled: true
    tick-interval: 2  # 矿车tick间隔 / Minecart tick interval

# 配方优化 / Recipe Optimization
recipe-optimization:
  # FastFurnace熔炉配方缓存 / FastFurnace Recipe Cache
  # 缓存熔炉配方避免重复查找，自定义配方多时提升明显
  # Cache furnace recipes to avoid repeated lookups, significant boost with custom recipes
  furnace-recipe-cache:
    enabled: true
    cache-size: 100  # 缓存大小 / Cache size (每个熔炉缓存数 / cached recipes per furnace)
    apply-to-blast-furnace: true  # 应用于高炉 / Apply to blast furnaces
    apply-to-smoker: true  # 应用于烟熏炉 / Apply to smokers
    fix-burn-time-bug: true  # 修复>32767燃烧时间bug / Fix >32767 burn time bug
  
  # C2ME NBT优化 / C2ME NBT Optimization
  # 来源 / Source: C2ME Fabric mod
  # ListTag使用fastutil，Paper已优化CompoundTag / ListTag uses fastutil, Paper already optimizes CompoundTag
  c2me-nbt-optimization:
    enabled: true
  
  # FastWorkbench工作台缓存 / FastWorkbench Cache
  # 缓存工作台配方，优化批量合成
  # Cache crafting recipes, optimize batch crafting
  # ⚠️ 实验性功能 / Experimental: 可能与某些插件冲突 / May conflict with plugins
  crafting-recipe-cache:
    enabled: false  # 默认关闭 / Disabled by default
    cache-size: 200  # 缓存大小 / Cache size
    optimize-batch-crafting: true  # 优化批量合成 / Optimize batch crafting (Shift+点击O(i×s)→1 / Shift+click O(i×s)→1)
    reduce-network-traffic: true  # 减少网络流量 / Reduce network traffic (减少配方同步 / reduce recipe sync)

# 杂项优化 / Misc Optimizations
misc-optimizations:
  # 矿车炼药锅销毁 / Minecart Cauldron Destruction
  # 支持漏斗/箱子矿车 / Supports hopper/chest minecarts
  minecart-cauldron-destruction:
    enabled: true

# 智能滞后补偿 / Smart Lag Compensation
# 在低TPS时自动补偿，保持游戏体验一致
# Auto-compensate during low TPS to maintain consistent game experience
smart-lag-compensation:
  enabled: true
  tps-threshold: 18.0  # TPS阈值 / TPS threshold (低于此值时启用补偿 / enable compensation when below)
  
  # 掉落物拾取延迟补偿 / Item Pickup Delay Compensation
  # 在低TPS时减少拾取延迟，保持玩家体验一致
  # Reduce pickup delay during low TPS to maintain player experience
  item-pickup-delay:
    enabled: true
  
  # 药水效果补偿 / Potion Effect Compensation
  # 在低TPS时额外tick药水效果，保持持续时间一致
  # Extra tick potion effects during low TPS to maintain duration
  # ⚠️ 可能改变游戏平衡 / May affect game balance: 药水效果可能消耗更快 / potion effects may consume faster
  potion-effects:
    enabled: false  # 默认关闭 / Disabled by default
  
  # 时间加速 / Time Acceleration
  # 在低TPS时加速游戏时间流逝，保持昼夜循环一致
  # Accelerate game time during low TPS to maintain day/night cycle
  # ⚠️ 可能影响某些依赖时间的机制 / May affect time-dependent mechanics
  time-acceleration:
    enabled: false  # 默认关闭 / Disabled by default

# TNT爆炸优化 / TNT Explosion Optimization
# 多线程并行处理TNT爆炸计算，大幅提升性能
# Multi-threaded parallel TNT explosion calculations for significant performance boost
# 注意：Mixin仅注入PrimedTnt，无需白名单配置
# Note: Mixin only injects to PrimedTnt, no whitelist needed
tnt-explosion-optimization:
  enabled: true
  
  # 原版兼容性 / Vanilla Compatibility
  # 确保TNT行为与原版一致
  # Ensure TNT behavior matches vanilla
  vanilla-compatibility:
    enabled: true
    use-vanilla-power: true  # 使用原版爆炸威力 / Use vanilla explosion power
    use-vanilla-fire-logic: true  # 使用原版火焰逻辑 / Use vanilla fire logic
    use-vanilla-damage-calculation: true  # 使用原版伤害计算 / Use vanilla damage calculation (⚠️ 重要 / IMPORTANT)
    use-full-raycast: false  # 使用完整射线追踪 / Use full raycast (更精确但性能开销大 / more accurate but higher cost)
    use-vanilla-block-destruction: true  # 使用原版方块破坏 / Use vanilla block destruction
    use-vanilla-drops: true  # 使用原版掉落物 / Use vanilla drops
  
  # 爆炸缓存优化 / Explosion Cache Optimization
  cache:
    enabled: true
    cache-expiry-ticks: 600  # 缓存过期时间 / Cache expiry (tick, 600 = 30秒)
  
  # 爆炸密度缓存 / Explosion Density Cache (Sakura)
  # 使用空间索引加速实体查询
  # Use spatial index to accelerate entity queries
  density-cache:
    enabled: true
  
  # 向量化AABB检测 / Vectorized AABB Detection
  # 使用SIMD向量化加速实体碰撞检测
  # Use SIMD vectorization to accelerate entity collision detection
  vectorized-aabb:
    enabled: true
  
  # 统一爆炸引擎 / Unified Explosion Engine (推荐 / Recommended)
  # 整合所有爆炸计算，使用ByteVector优化 (4x吞吐量)
  # Unified calculation with ByteVector optimization (4x throughput)
  unified-engine:
    enabled: true
  
  # TNT实体合并 / TNT Entity Merging
  # 合并附近的TNT实体，适用于大炮服务器
  # Merge nearby TNT entities, suitable for cannon servers
  entity-merge:
    enabled: false  # 默认关闭 / Disabled by default
    radius: 1.5  # 合并半径 / Merge radius (方块 / blocks)
    max-fuse-difference: 5  # 最大引信时间差 / Max fuse time difference (tick)
    power-multiplier: 0.5  # 威力增益系数 / Power gain multiplier
    max-power: 12.0  # 最大爆炸威力 / Maximum explosion power
  
  # 领地/容器保护说明 / Land/Container Protection Note
  # 保护功能现在通过 Bukkit EntityExplodeEvent 处理
  # Protection is now handled via Bukkit EntityExplodeEvent
  # 所有监听此事件的插件（Residence/WorldGuard/Lands/Dominion/BlockLocker等）都会自动生效
  # All plugins listening to this event (Residence/WorldGuard/Lands/Dominion/BlockLocker, etc.) will work automatically

# 下落方块并行处理 / Falling Block Parallel
# 多线程并行处理下落方块，适用于重力方块和大规模下落场景
# Multi-threaded parallel falling block processing for gravity blocks and massive falling scenarios
falling-block-optimization:
  enabled: true
  min-falling-blocks: 20  # 最少下落方块数 / Min falling blocks (推荐 / Recommended: 20-50)
  batch-size: 10  # 批量大小 / Batch size (推荐 / Recommended: 10-20)

# ==========================================
# 区块系统优化 / Chunk System Optimization
# ==========================================
# 整合所有区块相关优化，包括生成、加载、保存、IO等
# Unified chunk optimizations including generation, loading, saving, IO, etc.
# 来源 / Sources: C2ME, Nitori, 原创优化 / Original optimizations
# 注意：所有异步操作使用统一线程池 / Note: All async operations use unified thread pool

chunk-system:
  # 主开关 / Master Switch
  enabled: true
  
  # 区块生成优化 / Chunk Generation
  generation:
    # 噪声采样优化 / Noise Optimization
    # 优化噪声采样计算，提升地形生成速度
    # Optimize noise sampling calculations to boost terrain generation speed
    noise-optimization:
      enabled: true
    
    # Jigsaw 结构生成优化 / Jigsaw Structure Optimization
    # 优化Jigsaw结构生成，提升村庄等结构生成速度
    # Optimize Jigsaw structure generation to boost village generation speed
    jigsaw-optimization:
      enabled: true
    
    # ChunkPos equals优化 / ChunkPos Equals Optimization
    # 使用标准equals实现，避免不必要的对象创建
    # Use standard equals implementation to avoid unnecessary object creation
    # 来源 / Source: C2ME
    chunk-pos-optimization:
      enabled: true
    
    # Perlin噪声优化 / Perlin Noise Optimization
    # 优化噪声采样算法
    # Optimize noise sampling algorithm
    # 来源 / Source: C2ME
    perlin-noise-optimization:
      enabled: true
  
  # 区块加载优化 / Chunk Loading
  loading:
    # 异步区块加载 / Async Chunk Loading
    # 异步读取区块数据，减少主线程阻塞（使用统一线程池）
    # Async chunk data reading to reduce main thread blocking (uses unified thread pool)
    # 来源 / Source: C2ME
    async-loading:
      enabled: true
      cache-size: 256  # 读取缓存大小 / Read cache size
    
    # Mid-Tick 区块任务 / Mid-Tick Chunk Tasks
    # 在tick中间执行区块任务，减少延迟
    # Execute chunk tasks mid-tick to reduce latency
    # 来源 / Source: C2ME
    mid-tick-tasks:
      enabled: true
      interval-ns: 1000000  # 执行间隔(纳秒) / Execution interval (nanoseconds) (1ms)
    
    # 异步Blending状态计算 / Async Blending Status Calculation
    # 异步计算blending状态，减少世界升级卡顿
    # Async blending status calculation to reduce world upgrade lag
    # 来源 / Source: C2ME
    async-blending:
      enabled: true
  
  # 区块保存优化 / Chunk Saving
  saving:
    # 异步区块序列化 / Async Chunk Serialization
    # 将区块序列化移到后台线程（使用统一线程池）
    # Move chunk serialization to background threads (uses unified thread pool)
    # 来源 / Source: C2ME
    async-serialization:
      enabled: true
    
    # 区块卸载队列优化 / Chunk Unload Queue Optimization
    # 优化卸载队列处理，避免O(n)的size()调用
    # Optimize unload queue processing, avoid O(n) size() calls
    # 来源 / Source: C2ME
    unload-queue-optimization:
      enabled: true
  
  # 磁盘IO优化 / Disk IO
  io:
    # 异步磁盘写入 / Async Disk Write
    # 禁用dsync，提升IO性能（正常关服不会丢数据）
    # Disable dsync for better IO performance (no data loss on normal shutdown)
    # 使用 -Dakiasync.chunk.forceDsync=true 强制启用同步写入
    # Use -Dakiasync.chunk.forceDsync=true to force sync writes
    # 来源 / Source: C2ME
    async-disk-write:
      enabled: true
    
    # 存储IO工作线程优化 / Storage IO Worker Optimization
    # 使用统一线程池，避免阻塞其他任务
    # Use unified thread pool to avoid blocking other tasks
    # 来源 / Source: C2ME
    storage-io-worker:
      enabled: true
    
    # NBT缓存限制 / NBT Cache Limit
    # 限制NBT缓存大小，防止内存泄漏
    # Limit NBT cache size to prevent memory leaks
    # 来源 / Source: C2ME
    nbt-cache-limit:
      enabled: true
      max-size: 256  # 最大缓存条目数 / Max cache entries
  
  # ------------------------------------------
  # 方块Tick优化 / Block Tick
  # ------------------------------------------
  block-tick:
    # 方块Tick异步化 / Block Tick Async
    # Folia环境下自动禁用 / Auto-disabled on Folia
    async:
      enabled: false
      timeout-us: 200  # 超时 / Timeout (微秒 / microseconds)
      batch-size: 16  # 批量大小 / Batch size

# ==========================================
# 结构查找异步化 / Structure Location Async
# ==========================================
# 异步处理结构查找操作，避免主线程阻塞
# Async structure finding to prevent main thread blocking
structure-location-async:
  enabled: true
  
  # /locate 命令优化 / /locate Command Optimization
  # 异步处理/locate命令，避免卡顿
  # Async /locate command to avoid lag
  locate-command:
    enabled: true
    search-radius: 100  # 搜索半径 / Search radius (区块 / chunks)
    skip-known-structures: false  # 跳过已知结构 / Skip known structures (加速搜索 / speed up search)
  
  # 村民交易地图优化 / Villager Trade Map Optimization
  # 异步生成村民交易地图
  # Async villager trade map generation
  villager-trade-maps:
    enabled: true
    search-radius: 100  # 搜索半径 / Search radius (区块 / chunks)
    skip-known-structures: false  # 跳过已知结构 / Skip known structures
    trade-types:  # 支持的地图类型 / Supported map types
      - "minecraft:ocean_monument_map"
      - "minecraft:woodland_mansion_map"
      - "minecraft:buried_treasure_map"
    generation-timeout-seconds: 30  # 生成超时时间 / Generation timeout (秒 / seconds)
  
  # 海豚寻宝优化 / Dolphin Treasure Hunt Optimization
  # 异步处理海豚寻宝
  # Async dolphin treasure hunt
  dolphin-treasure-hunt:
    enabled: true
    search-radius: 50  # 搜索半径 / Search radius (方块 / blocks)
  
  # 箱子探险地图生成 / Chest Exploration Map Generation
  # 异步生成箱子中的探险地图
  # Async exploration map generation in chests
  chest-exploration-maps:
    enabled: true
    loot-tables:  # 包含地图的战利品表 / Loot tables containing maps
      - "minecraft:chests/shipwreck_map"
      - "minecraft:chests/underwater_ruin_big"
      - "minecraft:chests/underwater_ruin_small"
  
  # 算法优化 / Algorithm Optimization
  # 优化结构搜索算法，提升搜索效率
  # Optimize structure search algorithm to improve search efficiency
  algorithm-optimization:
    enabled: true
    search-pattern: "hybrid"  # 搜索模式 / Search pattern (spiral=螺旋 / spiral, layered=分层 / layered, hybrid=混合 / hybrid)
    caching:
      enabled: true
      max-size: 1000  # 缓存最大条目数 / Maximum cache entries
      expiration-minutes: 30  # 缓存过期时间 / Cache expiration (分钟 / minutes)
    biome-aware-search:
      enabled: true  # 基于生物群系智能搜索 / Biome-aware intelligent search

# ==========================================
# 高级特性与实验性优化 / Advanced Features & Experimental
# ==========================================

# 光照优化 / Lighting Optimizations
# 参考ScalableLux，使用时间窗口控制更新频率 / Based on ScalableLux, use time window to control update frequency
lighting-optimizations:
  enabled: true
  update-interval-ms: 10  # 光照更新间隔 / Light update interval (推荐 10ms / Recommended: 10ms, 5ms=更快 / faster, 20ms=更省CPU / lower CPU)
  
  # 光照更新批处理 / Light Update Batching
  # 批量处理光照更新，减少调度开销
  # Batch light updates to reduce scheduling overhead
  light-batching:
    enabled: true

# 出生区块移除 / Spawn Chunk Removal
# 移除出生区块以加速世界加载 / Remove spawn chunks to speed up world loading
# ⚠️ 仅对 1.21.8 有效 / Only effective on 1.21.8
# 1.21.10+ 版本已默认移除出生区块 / 1.21.10+ already removed spawn chunks by default
spawn-chunk-removal:
  enabled: true

# 蜜蜂修复 / Bee Fix
# 修复7个MC bug / Fixes 7 MC bugs
# MC-168329/190042/206401/229321/234364/248332/255743
bee-fix:
  enabled: true

# 潜影贝子弹自伤修复 / Shulker Bullet Self-Hit Fix
# 防御性修复：防止潜影贝子弹击中发射它的潜影贝自己
# Defensive fix: Prevent shulker bullets from hitting the shulker that fired them
shulker-bullet-self-hit-fix:
  enabled: true

# MC-159283 修复 / MC-159283 Fix
# 修复End维度地形环形缺失
# Fix End terrain ring gaps
# 参考 / Reference: https://bugs.mojang.com/browse/MC-159283
end-island-density-fix:
  enabled: true

# MC-219981 修复 / MC-219981 Fix
# 修复首领僵尸生成时血量错误的问题
# Fix leader zombie spawning with incorrect health
# 参考 / Reference: https://bugs.mojang.com/browse/MC-219981
leader-zombie-health-fix:
  enabled: true

# 传送门窒息检查禁用 / Portal Suffocation Check Disable
# Mojang在1.19.3添加了实体传送后的窒息检查算法
# 禁用此检查可大幅提升传送门性能，但极少数情况下大型生物可能卡在方块内
# Mojang added suffocation check after entity teleportation in 1.19.3
# Disabling this check greatly improves portal performance, but rarely large mobs may get stuck
portal-suffocation-check:
  disabled: false  # false=保持原版行为 / keep vanilla, true=禁用检查提升性能 / disable for performance

# 末影人方块搬运限制 / Enderman Block Carry Limiter
# 修复Mojang的bug：手持方块的末影人不占刷怪上限导致无限堆积 / Fix Mojang's bug: Endermen carrying blocks don't count towards mob cap
# ⚠️ 注意：如果启用了 entity-throttling，建议将此功能设为 false / Note: Set to false if entity-throttling is enabled
enderman-block-carry-limiter:
  enabled: true  # 启用限制器 / Enable limiter (推荐 true，entity-throttling 启用时建议 false / Recommended: true, false if entity-throttling enabled)
  max-carrying-endermen: 50  # 最大手持方块末影人数量 / Max carrying endermen (推荐 30-100 / Recommended: 30-100)
  count-towards-mob-cap: true  # 强制计入刷怪上限 / Count towards mob cap (修复原版bug / Fix vanilla bug)
  prevent-pickup-when-limit-reached: true  # 达到限制时阻止拾取 / Prevent pickup when limit reached

# 数据包加载优化 / DataPack Loading Optimization
# 多线程并行加载数据包，提升加载速度
# Multi-threaded parallel datapack loading to boost loading speed
datapack-optimization:
  enabled: true
  batch-size: 100  # 批量大小 / Batch size
  cache-expiration-minutes: 30  # 缓存过期时间 / Cache expiration (分钟 / minutes)
  max-file-cache-size: 1000  # 文件缓存上限 / Max file cache size (防止内存泄漏 / prevent memory leak)
  max-filesystem-cache-size: 50  # 文件系统缓存上限 / Max filesystem cache size
  
  # Execute 命令跳过不活跃实体 / Execute Command Inactive Entity Skip
  # 优化execute as @e等命令的性能，跳过不活跃的实体
  # Optimize performance of execute as @e commands by skipping inactive entities
  execute-inactive-skip:
    enabled: false  # 默认禁用 / Disabled by default
    skip-level: 2  # 跳过级别 / Skip level (0=禁用 / disabled, 1=未加载区块 / unloaded chunks, 2=模拟距离外 / outside simulation, 3=所有不活跃 / all inactive)
    simulation-distance-multiplier: 1.0  # 模拟距离倍数 / Simulation distance multiplier
    cache-duration-ms: 1000  # 缓存持续时间 / Cache duration (毫秒 / milliseconds)
    whitelist-types:  # 白名单实体类型 / Whitelist entity types (永不跳过 / never skip)
      - "minecraft:player"
      - "minecraft:armor_stand"
  
  # 函数命令去重 / Command Deduplication
  # 去重数据包函数中的重复命令对象，减少内存使用
  # Deduplicate command objects to reduce memory usage
  command-deduplication:
    enabled: true

# 数学优化 / Math Optimization
# 优化三角函数计算性能
# Optimize trigonometric function performance
math-optimization:
  enabled: true
  compact-sine-lut: true  # 紧凑型正弦查找表 / Compact sine lookup table (节省75%内存 / saves 75% memory)
  
  # C2ME 资源与内存优化 / C2ME Resource & Memory Optimizations
  # 来源 / Source: C2ME Fabric mod
  c2me-optimizations:
    bitset-pooling:  # BitSet对象池 / BitSet Object Pooling (ThreadLocal缓存BitSet对象 / ThreadLocal cache for BitSet objects)
      enabled: true
    completable-future-optimization:  # CompletableFuture优化 / CompletableFuture Optimization (优化异步任务组合 / Optimize async task combining)
      enabled: true
    blockpos-cache: true  # BlockPos缓存 / BlockPos cache (预计算减少开销 / pre-compute to reduce overhead)
    optimized-collections: true  # 优化集合类 / Optimized collections (高性能集合类 / high-performance collections)

# 安全种子保护 / Secure Seed Protection
# 加密世界种子，防止种子泄露和逆向工程
# Encrypt world seed to prevent seed leakage and reverse engineering
# ⚠️ 重要 / IMPORTANT: 启用后不可关闭 / DO NOT disable after enabling
# 关闭会导致 / Disabling causes: 区块错乱/结构消失/矿石改变/史莱姆区块变化
# Chunk mismatch/Structure loss/Ore changes/Slime chunk changes
# 如需关闭必须删除世界 / Must delete world to disable
seed-encryption:
  enabled: false
  scheme: "quantum"  # 加密方案 / Encryption scheme (legacy=传统 / traditional, quantum=量子推荐 / quantum recommended)
  
  # 保护范围 / Protection Scope
  protect-structures: true  # 保护结构 / Protect structures (村庄/要塞/遗迹 / villages/strongholds/monuments)
  protect-ores: true  # 保护矿石 / Protect ores (钻石/金矿等 / diamonds/gold etc.)
  protect-slimes: true  # 保护史莱姆区块 / Protect slime chunks
  
  # Legacy方案配置 / Legacy Scheme Config
  # 仅当scheme=legacy时生效 / Only effective when scheme=legacy
  legacy:
    seed-bits: 1024  # 种子位数 / Seed bits (1024/2048/4096, 推荐1024平衡性能 / recommended 1024 for balance)
  
  # Quantum方案配置 / Quantum Scheme Config
  # 仅当scheme=quantum时生效 / Only effective when scheme=quantum
  quantum:
    encryption-level: 2  # 加密强度 / Encryption level (1=基础 / basic, 2=标准推荐 / standard recommended, 3=最强 / maximum)
    private-key-file: "quantum-seed.key"  # 服务器私钥文件 / Server private key file (⚠️ 自动生成，请备份！/ Auto-generated, backup it!)
    enable-time-decay: false  # 时间衰减 / Time decay (防时间攻击，可能影响重生成 / anti-time-attack, may affect regen)
    cache-size: 10000  # 缓存大小 / Cache size (推荐 / Recommended: 5000-20000)
  
  # /seed 命令权限控制 / /seed Command Permission Control
  restrict-seed-command: true  # 限制/seed命令仅OP可用 / Restrict /seed to OPs only (权限等级4 / permission level 4)
  
  # 防插件窃取种子 / Anti-Plugin Seed Theft
  # 防止恶意插件窃取世界种子
  # Prevent malicious plugins from stealing world seed
  anti-plugin-theft:
    enabled: true
    return-fake-seed: true  # 返回假种子 / Return fake seed (给可疑调用者 / to suspicious callers)
    fake-seed-value: 0  # 假种子值 / Fake seed value (0 = 随机 / random, 或指定数字 / or specify a number)
    log-suspicious-access: true  # 记录可疑访问 / Log suspicious seed access attempts

# ==========================================
# 网络优化 / Network Optimization
# ==========================================
network-optimization:
  
  # 区块可见性过滤 / Chunk Visibility Filter
  # 遮挡剔除：只发送玩家视野内的表层区块
  # Occlusion culling: Only send surface chunks in player's view
  chunk-visibility-filter:
    enabled: true
  
  # 高速移动区块预加载 / Fast Movement Chunk Loading
  # 鞘翅/疾跑/创造飞行时预加载区块，避免卡顿
  # Preload chunks during elytra/sprint/creative flight to avoid lag
  fast-movement-chunk-load:
    enabled: true
    speed-threshold: 0.5  # 触发速度 / Trigger speed (b/t, 推荐 / Recommended: 0.5/0.3/0.8)
    preload-distance: 8  # 预加载距离 / Preload distance (推荐 / Recommended: 8/6/10)
    max-concurrent-loads: 4  # 最大并发加载 / Max concurrent loads (推荐 / Recommended: 4/2/6)
    prediction-ticks: 40  # 预测tick数 / Prediction ticks (推荐 / Recommended: 40/30/50)
    
    # 智能偏移加载中心 / Smart Center Offset
    # 根据速度方向偏移实现类远视距效果
    # Offset by speed/direction for pseudo-far-render-distance effect
    center-offset:
      enabled: true
      min-speed: 3.0  # 最小触发速度 / Min trigger speed (b/t, 推荐 / Recommended: 3.0/2.0/4.0)
      max-speed: 9.0  # 最大触发速度 / Max trigger speed (b/t, 推荐 / Recommended: 9.0/7.0/12.0, ⚠️ 过高可能卸载玩家 / too high may unload player)
      max-offset-ratio: 0.75  # 最大偏移比例 / Max offset ratio (推荐 / Recommended: 0.75/0.5/0.9)
    
    # 异步加载批量控制 / Async Batch Control
    # 防止MSPT飙升
    # Prevent MSPT spikes
    async-loading:
      batch-size: 2  # 每批区块数 / Chunks per batch (推荐 / Recommended: 2/3/4)
      batch-delay-ms: 20  # 批次延迟 / Batch delay (毫秒 / milliseconds, 推荐 / Recommended: 20/15/10)
    
    # 玩家加入热身期 / Player Join Warmup Period
    # 玩家刚进入时逐渐增加区块加载速率，避免MSPT峰值
    # Gradually increase chunk loading rate when player joins to avoid MSPT spikes
    player-join-warmup:
      enabled: true
      warmup-duration-ms: 3000  # 热身期时长 / Warmup duration (毫秒 / milliseconds, 推荐 / Recommended: 3000/2000/5000)
      initial-rate: 0.5  # 初始加载速率 / Initial loading rate (0.0-1.0, 推荐 / Recommended: 0.5/0.3/0.7)
    
    # 地图渲染加速 / Map Rendering
    # 高速移动时优化地图渲染
    # Optimize map rendering during fast movement
    # ⚠️ 实验性功能 / Experimental
    map-rendering:
      enabled: false
  
  # 高级网络优化 / Advanced Network Optimization
  # 基于Velocity代理端的高性能网络优化技术
  # High-performance network optimization based on Velocity proxy
  advanced:
    enabled: true
    
    # 快速VarInt编码 / Fast VarInt Encoding
    # 使用内联优化和快速路径加速VarInt编码/解码
    # Use inline optimization and fast paths to accelerate VarInt encode/decode
    # 性能提升：1字节路径提升50%，2字节路径提升30% / Boost: 1-byte path 50% faster, 2-byte path 30% faster
    fast-varint:
      enabled: true
    
    # EventLoop亲和性检查 / EventLoop Affinity Checking
    # 确保网络操作在正确的EventLoop线程执行，避免线程竞争
    # Ensure network operations execute in correct EventLoop thread to avoid contention
    # 性能提升：减少跨线程调度开销10-20% / Boost: reduce cross-thread scheduling overhead 10-20%
    eventloop-affinity:
      enabled: true
      strict-checking: false  # 严格检查模式 / Strict checking mode (启用后会记录违规警告 / logs violations when enabled)
    
    # ByteBuf优化器 / ByteBuf Optimizer
    # 优化ByteBuf分配策略，使用池化和直接内存
    # Optimize ByteBuf allocation with pooling and direct memory
    # 性能提升：减少GC压力40-60%，内存分配速度提升20-40% / Boost: reduce GC pressure 40-60%, allocation speed 20-40% faster
    bytebuf-optimizer:
      enabled: true
      pooled-allocator: true  # 使用池化分配器 / Use pooled allocator (减少内存分配开销 / reduce allocation overhead)
      prefer-direct: true  # 优先使用直接内存 / Prefer direct memory (减少JVM堆内存使用 / reduce JVM heap usage)
    
    # 零移动包过滤 / Zero Movement Packet Filter
    # 基于ESU插件的SkipUnnecessaryPackets优化 / Based on ESU's SkipUnnecessaryPackets optimization
    # 过滤位置和旋转均为零的移动包，减少10-15%实体包 / Filter packets with zero movement/rotation, reduce 10-15% entity packets
    skip-zero-movement-packets:
      enabled: true
      strict-mode: false  # 严格模式 / Strict mode (true=位置和旋转都为零才过滤 / filter only when both are zero, false=位置为零即过滤 / filter when position is zero)
    
    # MTU感知批处理 / MTU-Aware Batching
    # 基于Pulse-Paper的Smart Batching优化 / Based on Pulse-Paper's Smart Batching
    # 根据MTU大小批量发送包，避免IP分片 / Batch packets based on MTU size to avoid IP fragmentation
    # 性能提升 / Performance gain: 减少97%网络PPS / reduce 97% network PPS
    mtu-aware-batching:
      enabled: true
      mtu-limit: 1396  # MTU限制 / MTU limit (1460 - 64 safety margin)
      hard-cap-packets: 4096  # 硬性包数量上限 / Hard cap on packet count
    
    # Flush合并 / Flush Consolidation
    # 基于Paper的FlushConsolidationHandler优化 / Based on Paper's FlushConsolidationHandler
    # 合并多次flush操作为一次，减少系统调用 / Consolidate multiple flush operations into one
    flush-consolidation:
      enabled: true
      explicit-flush-after: 256  # 显式flush间隔 / Explicit flush after N flushes
      consolidate-when-no-read: true  # 无读取时合并 / Consolidate when no read in progress
    
    # 原生压缩 / Native Compression (Velocity libdeflate)
    # 使用Velocity的libdeflate库进行压缩 / Use Velocity's libdeflate for compression
    # 比Java zlib快2-3倍 / 2-3x faster than Java zlib
    native-compression:
      enabled: true
      level: 6  # 压缩级别 / Compression level (1-9, 6=balanced)
    
    # 原生加密 / Native Encryption (Velocity OpenSSL)
    # 使用Velocity的OpenSSL库进行加密 / Use Velocity's OpenSSL for encryption
    # 比Java内置加密更快 / Faster than Java built-in cipher
    native-encryption:
      enabled: true
    
    # 爆炸优化 / Explosion Optimization
    # 基于Pulse-Paper的Adaptive Block Updates优化 / Based on Pulse-Paper's Adaptive Block Updates
    # 当区块内方块更新超过阈值时，发送整个区块而非单独更新 / Send full chunk instead of individual updates when threshold exceeded
    # 性能提升 / Performance gain: 大幅减少爆炸时的网络流量 / significantly reduce network traffic during explosions
    explosion-optimization:
      enabled: true
      block-change-threshold: 512  # 方块更新阈值 / Block change threshold (超过此数量发送整个区块 / send full chunk when exceeded)
  
  # AFK玩家网络包节流 / AFK Player Packet Throttle
  # 参考ESU的AfkEfficiency功能 / Based on ESU's AfkEfficiency
  # 对AFK玩家限制粒子、声音等非关键包的发送 / Limit non-critical packets (particles, sounds) for AFK players
  # 性能提升 / Performance gain: 减少20-40%网络流量 / reduce 20-40% network traffic for AFK players
  afk-packet-throttle:
    enabled: true
    afk-duration-ms: 120000  # AFK判定时间 / AFK detection time (毫秒 / milliseconds, 2分钟无移动视为AFK / 2 min no movement = AFK)
    particle-max-distance: 0.0  # 粒子最大距离 / Particle max distance (0=完全过滤 / 0=filter all, >0=距离过滤 / >0=distance filter)
    sound-max-distance: 64.0  # 声音最大距离 / Sound max distance (超过此距离的声音不发送 / sounds beyond this distance not sent)
  
  # 动态区块发送速率 / Dynamic Chunk Send Rate
  # 参考ESU的DynamicChunkSendRate功能 / Based on ESU's DynamicChunkSendRate
  # 根据玩家带宽和服务器负载动态调整区块发送速率 / Dynamically adjust chunk send rate based on player bandwidth and server load
  dynamic-chunk-send-rate:
    enabled: true
    limit-upload-bandwidth: 10240  # 限制上传带宽 / Limit upload bandwidth (KB/s)
    guaranteed-bandwidth: 512  # 保证带宽 / Guaranteed bandwidth (KB/s per player)
  
  # 包压缩优化 / Packet Compression Optimization
  # 优化压缩阈值和缓冲区分配 / Optimize compression threshold and buffer allocation
  packet-compression:
    enabled: true
    adaptive-threshold: true  # 自适应压缩阈值 / Adaptive compression threshold
    skip-small-packets: true  # 跳过小包压缩 / Skip small packet compression
    skip-threshold: 32  # 跳过阈值 / Skip threshold (字节 / bytes)
  
  # 区块批量优化 / Chunk Batch Optimization
  # 根据玩家网络状况动态调整区块批量发送 / Dynamically adjust chunk batch sending based on player network
  chunk-batch:
    enabled: true
    min-chunks: 2.0  # 最小区块数 / Min chunks per tick
    max-chunks: 32.0  # 最大区块数 / Max chunks per tick
    max-unacked-batches: 8  # 最大未确认批次 / Max unacknowledged batches
  
  # 包优先级队列 / Packet Priority Queue
  # 对不同类型的包设置优先级，确保关键包优先发送 / Prioritize different packet types
  packet-priority:
    enabled: true
    prioritize-player-packets: true  # 优先玩家包 / Prioritize player packets
    prioritize-chunk-packets: true  # 优先区块包 / Prioritize chunk packets
    deprioritize-particles: true  # 降低粒子优先级 / Deprioritize particles
    deprioritize-sounds: true  # 降低声音优先级 / Deprioritize sounds

# ==========================================
# 高级优化 / Advanced Optimizations
# ==========================================
# 来自多个高性能模组的优化 / Optimizations from multiple high-performance mods
# 来源 / Sources: VMP, Nitori, Lithium

advanced-optimizations:
  # 并发优化 / Concurrency (Nitori)
  virtual-threads: true  # Java 21虚拟线程 / Java 21 virtual threads (旧版自动降级 / auto-fallback)
  work-stealing: true  # 工作窃取调度 / Work-stealing scheduling
  
  # 网络优化 / Network (VMP)
  # 分离Login/Play网络IO，减少竞争 / Separate Login/Play network IO to reduce contention
  multi-netty-event-loop: true
  
  # 区块优化 / Chunk (VMP)
  # 移除PalettedContainer锁 / Remove PalettedContainer locking
  # ⚠️ Paper/Folia已在更高层级同步 / Paper/Folia already syncs at higher level
  paletted-container-lock-removal: true
  
  # 集合优化 / Collections (VMP/Lithium)
  # 使用fastutil高性能集合 / Use fastutil high-performance collections
  type-filterable-list: true  # 实体类型过滤 / Entity type filtering (+20-40%)
  entity-tracker-linked-hashmap: true  # 实体追踪器 / Entity tracker
  spawn-density-array: true  # 生成密度检查 / Spawn density check (+3-5x)
  
  # 世界生成优化 / Worldgen (VMP)
  # 内联生物群系采样 / Inline biome sampling (-10-20% overhead)
  biome-access-optimization: true
  
  # 实体优化 / Entity (VMP)
  # 跳过零速度移动计算 / Skip zero velocity move calculations
  entity-move-zero-velocity: true
  # 缓存实体追踪距离 / Cache entity tracker distance per tick
  entity-tracker-distance-cache: true

# ==========================================
# 性能监控与调试 / Performance Monitoring & Debug
# ==========================================
performance:
  # Debug 日志配置 / Debug Logging Configuration
  # 仅用于调试，生产环境建议关闭
  # For debugging only, disable in production
  debug-logging:
    enabled: false
    modules:
      tnt: false  # TNT爆炸调试 / TNT explosion debug
      collision: false  # 碰撞检测调试 / Collision detection debug
      lighting: false  # 光照计算调试 / Lighting calculation debug
      pathfinding: false  # 寻路调试 / Pathfinding debug
      entity: false  # 实体系统调试 / Entity system debug
      chunk: false  # 区块系统调试 / Chunk system debug
      hopper: false  # 漏斗系统调试 / Hopper system debug
      math: false  # 数学优化调试 / Math optimization debug
      shapes: false  # 形状优化调试 / Shape optimization debug
      datapack: false  # 数据包优化调试 / Datapack optimization debug
      execute-command: false  # Execute命令优化调试 / Execute command optimization debug
      command-deduplication: false  # 命令去重调试 / Command deduplication debug
      smart-lag-compensation: false  # 智能滞后补偿调试 / Smart lag compensation debug
      log-missed-ticks: false  # 记录丢失的tick / Log missed ticks
      log-compensation: false  # 记录补偿操作 / Log compensation actions
  
  # 性能指标收集 / Performance Metrics
  # 显示异步任务时间和队列状态
  # Show async task times and queue status
  enable-metrics: true

# ==========================================
# 指令配置 / Command Configuration
# ==========================================
commands:
  # /aki-reload指令 / /aki-reload Command
  reload:
    require-confirmation: true  # 二次确认 / Confirmation (首次警告需再次执行 / warning on first, execute twice)
    confirmation-timeout: 30  # 确认超时 / Timeout (秒 / seconds)

# 提示 / Tip: 更多线程≠更好性能！从推荐值开始调整
# More threads ≠ better performance! Start with recommended values.
