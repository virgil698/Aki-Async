# ==========================================
# AkiAsync 配置文件 / Configuration File
# ==========================================

# 配置版本 / Configuration version
# 当前版本 / Current version: 7
# 说明：当前配置版本为7，如果配置版本不等于7，则需要更新配置文件
# Description: The current configuration version is 7, if the configuration version is not equal to 7, you need to update the configuration file
version: 7

# ==========================================
# 实体系统优化 / Entity System Optimization
# ==========================================

# 异步实体追踪器 / Async Entity Tracker
# 说明：将实体位置更新移至异步线程处理
# Description: Offload entity position tracking to async threads
entity-tracker:
  enabled: true
  # 线程池大小 / Thread pool size
  # 推荐值：CPU核心数 / Recommended: CPU core count
  thread-pool-size: 4
  # 更新间隔（tick）/ Update interval (ticks)
  update-interval-ticks: 1
  # 最大队列大小 / Maximum queue size
  # 说明：追踪任务的缓冲队列大小，队列满时会降级为同步执行
  # 推荐值：1000-20000，高负载服务器建议设置更大
  # Description: Buffer queue size for tracking tasks, falls back to sync execution when full
  # Recommended: 1000-20000, higher values for high-load servers
  max-queue-size: 10000
  # 批量处理大小 / Batch processing size
  batch-size: 50

# 异步生物生成 / Async Mob Spawning
# 说明：异步处理生物自然生成逻辑
# Description: Async natural mob spawning logic
mob-spawning:
  enabled: true
  # 刷怪笼优化 / Spawner block optimization
  spawner-optimization: true

# 实体密度控制 / Entity Density Control
# 说明：限制单区块实体数量
# Description: Limit entities per chunk
density:
  # 单区块最大实体数 / Max entities per chunk
  max-per-chunk: 80

# AI降频 / Brain Throttle
# 说明：静止实体降低AI更新频率
# Description: Reduce AI update frequency for stationary entities
# 注意：UniversalAI会自动感知降频状态，保持一致性
# Note: UniversalAI respects throttle state automatically for consistency
brain:
  # 启用降频 / Enable throttling
  throttle: true
  # 降频间隔（tick）/ Throttle interval (ticks)
  throttle-interval: 10

# ==========================================
# 零延迟异步AI / Zero-Latency Async AI
# ==========================================
async-ai:
  # 全局超时时间（微秒）/ Global timeout (microseconds)
  # 100μs = 0.1ms
  timeout-microseconds: 100
  
  # 执行模式 / Execution mode
  mode: simple
  
  # ---------- 村民优化 / Villager Optimization ----------
  # 支持实体 / Supported: Villager, Wandering Trader
  # 技术特性 / Features: POI快照 + 职业原子占坑
  villager-optimization:
    # 启用开关 / Enable toggle
    enabled: false
    # 使用POI快照 / Use POI snapshot
    # 说明：村民需要POI系统（床、工作站）
    # Description: Villagers need POI system (beds, job sites)
    use-poi-snapshot: true
  
  # ---------- 猪灵家族优化 / Piglin Family Optimization ----------
  # 支持实体 / Supported: Piglin, PiglinBrute
  # 技术特性 / Features: UUID虚拟引用 + 物品比价 + 恐惧向量
  piglin-optimization:
    enabled: false
    use-poi-snapshot: false
    # 注视距离（格）/ Look distance (blocks)
    look-distance: 16
    # 交易距离（格）/ Barter distance (blocks)
    barter-distance: 16
  
  # ---------- 掠夺者家族优化 / Pillager Family Optimization ----------
  # 支持实体 / Supported: Pillager, Vindicator, Ravager
  # 技术特性 / Features: 安全反射写字段 + Raid检测
  # 注意 / Note: Evoker单独优化（见下方）
  pillager-family-optimization:
    enabled: false
    use-poi-snapshot: false
  
  # ---------- 高级AI实体优化 / High-AI Entity Optimization ----------
  
  # Evoker优化 / Evoker Optimization
  # 支持实体 / Supported: Evoker
  # 计算内容 / Computations: 法术CD + 召唤Vex + 空地块检测
  evoker-optimization:
    enabled: false
  
  # Blaze优化 / Blaze Optimization  
  # 支持实体 / Supported: Blaze
  # 计算内容 / Computations: 火焰弹CD + 火柱空位检测
  blaze-optimization:
    enabled: false
  
  # Guardian优化 / Guardian Optimization
  # 支持实体 / Supported: Guardian, ElderGuardian
  # 计算内容 / Computations: 激光CD + 水下玩家扫描
  # 说明：远古守卫者自动包含（Java继承）
  # Description: Elder guardian auto-included (Java inheritance)
  guardian-optimization:
    enabled: false
  
  # Witch优化 / Witch Optimization (v2.1: safe reflection)
  # 支持实体 / Supported: Witch
  # 计算内容 / Computations: 最近玩家目标筛选
  # 技术特性 / Features: printStackTrace + no rethrow（安全异常处理）
  witch-optimization:
    enabled: false
  
  # ========== 统一AI优化 / Universal AI Optimization ==========
  # 支持实体 / Supported: 所有剩余生物（见下方列表）
  # 技术特性 / Features: 统一模板 + 配置化实体列表 + 区域数量异步
  universal-ai-optimization:
    enabled: true
    # 启用的实体列表 / Enabled entity types
    # 格式 / Format: "minecraft:entity_name"
    entities:
      # 攻击型 / Attack type (hostile)
      - "minecraft:skeleton"
      - "minecraft:zombie"
      - "minecraft:creeper"
      - "minecraft:spider"
      - "minecraft:enderman"
      - "minecraft:phantom"
      - "minecraft:drowned"
      - "minecraft:hoglin"
      - "minecraft:zoglin"
      - "minecraft:stray"
      - "minecraft:husk"
      - "minecraft:zombie_villager"
      - "minecraft:shulker"
      - "minecraft:silverfish"
      - "minecraft:endermite"
      - "minecraft:cave_spider"
      # 防御型 / Defense type (golems)
      - "minecraft:iron_golem"
      - "minecraft:snow_golem"
      # 被动型 / Passive type (animals)
      - "minecraft:pig"
      - "minecraft:cow"
      - "minecraft:sheep"
      - "minecraft:chicken"
      - "minecraft:rabbit"
      - "minecraft:bat"
      - "minecraft:fox"
      - "minecraft:strider"
      - "minecraft:frog"
      - "minecraft:camel"
      - "minecraft:goat"
      - "minecraft:mushroom_cow"
      # 水生型 / Aquatic type
      - "minecraft:dolphin"
      - "minecraft:squid"
      - "minecraft:glow_squid"
      - "minecraft:turtle"
      - "minecraft:pufferfish"
      - "minecraft:tropical_fish"
      - "minecraft:cod"
      - "minecraft:salmon"
      - "minecraft:axolotl"
      # 驯服/中立型 / Tamed/Neutral type
      - "minecraft:wolf"
      - "minecraft:cat"
      - "minecraft:horse"
      - "minecraft:donkey"
      - "minecraft:mule"
      - "minecraft:llama"
      - "minecraft:parrot"
      - "minecraft:polar_bear"
      - "minecraft:panda"
      - "minecraft:bee"
      - "minecraft:ocelot"
      - "minecraft:trader_llama"
    # 节流间隔（tick）/ Tick interval
    tick-interval: 3
    # 超时时间（微秒）/ Timeout (microseconds)
    timeout-us: 100
    # 反射写回 / Reflection writeback
    control-goal: true
    # 批量大小 / Batch size
    batch-size: 8

# ==========================================
# 并行实体Tick / Parallel Entity Tick
# ==========================================
entity-tick-parallel:
  # 启用开关 / Enable toggle
  enabled: true
  # 线程数 / Thread count
  # 推荐：CPU核心数×1.5 / Recommended: CPU cores × 1.5
  threads: 6
  # 最小实体数阈值 / Minimum entities threshold
  # 说明：低于此值不启用并行（避免overhead）
  # Description: Skip parallel if entities < threshold
  min-entities: 50
  # 批量大小（实体级粒度）/ Batch size (entity-level granularity)
  # 说明：8个实体一批，任务均衡
  # Description: 8 entities per batch, balanced task size
  batch-size: 8

# ==========================================
# 性能优化套件 / Performance Optimizations
# ==========================================
servercore-optimizations:
  # 推挤优化 / Push optimization
  push-optimization:
    enabled: true
    interval: 2
  
  # 实体查找缓存 / Entity lookup cache
  entity-lookup-cache:
    enabled: true
    # 缓存有效期（毫秒）/ Cache duration (milliseconds)
    duration-ms: 50
  
  # 碰撞检测优化 / Collision optimization
  # 说明：优化实体碰撞检测，但保留重要状态检测
  # Description: Optimize entity collision detection while preserving important status detection
  # 保护的状态 / Protected status:
  #   - 细雪冰冻效果 / Powder snow freezing effect
  #   - 岩浆火焰伤害 / Lava and fire damage  
  #   - 掉落物销毁检测 / Item entity destruction detection
  collision-optimization:
    enabled: true
    # 最小移动阈值，低于此值时跳过碰撞检测 / Minimum movement threshold for skipping collision detection
    min-movement: 0.001

# ==========================================
# 内存优化套件 / Memory Optimizations
# ==========================================
memory-optimizations:
  # 谓词缓存 / Predicate cache
  # 说明：缓存常用谓词，降低GC压力
  # Description: Cache common predicates, reduce GC pressure
  predicate-cache:
    enabled: true
  
  # BlockPos对象池 / BlockPos object pool
  # 说明：复用BlockPos对象，减少26%内存分配
  # Description: Reuse BlockPos objects, 26% allocation reduction
  blockpos-pool:
    enabled: true
  
  # 列表预分配 / List pre-allocation
  # 说明：预分配容量，减少ArrayList扩容
  # Description: Pre-allocate capacity, reduce ArrayList resizing
  list-prealloc:
    enabled: true
    # 默认初始容量 / Default initial capacity
    default-capacity: 32

# ==========================================
# 掉落物优化 / Item Entity Optimizations (v5.0)
# ==========================================
item-entity-optimizations:
  enabled: true  # v5.0启用
  # Tick节流间隔 / Tick throttle interval
  # 说明：每N tick更新一次掉落物（空区域悬浮时）
  # Description: Update item entity every N ticks (when in empty region)
  # 推荐值 / Recommended: 5-10 (reduce 80-90% tick frequency)
  age-increment-interval: 10
  # 最少附近物品数 / Minimum nearby items for merge
  # 说明：附近物品少于此值时跳过tryToMerge检查
  # Description: Skip tryToMerge when nearby items < threshold
  min-nearby-items: 3

# ==========================================
# 村民繁殖优化 / Villager Breed Optimization (v8.0)
# ==========================================
villager-breed-optimization:
  # 启用异步繁殖检查 / Enable async breed check
  async-villager-breed: true
  # 线程池大小 / Thread pool size (breed check threads)
  threads: 4
  # 启用年龄降频 / Enable age throttle (skip idle villagers for 20 ticks)
  age-throttle: true
  # 繁殖检查间隔 / Breed check interval (ticks)
  check-interval: 5

# ==========================================
# 蜜蜂修复 / Bee Fix
# ==========================================
bee-fix:
  # 启用开关 / Enable toggle
  enabled: true
  # 修复的bug列表 / Fixed bugs list:
  #   - MC-168329: 蜜蜂拒绝在末地/下界离开蜂巢
  #   - MC-190042: 蜜蜂在不寻路时会掉落
  #   - MC-206401: 蜜蜂有西北方向的漫游偏向
  #   - MC-229321: 蜜蜂可能消失
  #   - MC-234364: 蜜蜂死亡动画只翻转90度
  #   - MC-248332: 蜜蜂可以破坏海龟蛋
  #   - MC-255743: 蜜蜂寻路系统可能导致性能问题

# ==========================================
# TNT爆炸优化 / TNT Explosion Optimization (v7.0)
# ==========================================
tnt-explosion-optimization:
  # 启用开关 / Enable toggle
  enabled: true
  # 启用的爆炸实体白名单 / Enabled explosion entities
  # 说明：只对这些实体的爆炸进行异步计算优化，其他爆炸走原版
  # Description: Only async optimize explosions from these entities
  entities:
    - "minecraft:tnt"           # TNT方块
    - "minecraft:tnt_minecart"  # TNT矿车（高频刷石机）
    - "minecraft:wither_skull"  # 凋灵头颅（威力8+刷石机）
  # 线程池大小 / Thread pool size
  # 推荐值 / Recommended: CPU核心数×1.5
  threads: 6

# ==========================================
# 方块实体优化 / Block Entity Optimizations
# ==========================================
block-entity-optimizations:
  # 支持实体 / Supported: Furnace, Hopper, Chest, Barrel
  # 技术特性 / Features: 配方缓存+物品传输+库存扫描异步化
  zero-delay-factory-optimization:
    enabled: true  # v3.0启用
    # 启用的实体列表 / Enabled entity types
    entities:
      - "minecraft:furnace"
      - "minecraft:blast_furnace"
      - "minecraft:smoker"
      - "minecraft:hopper"
      - "minecraft:chest"
      - "minecraft:barrel"
      - "minecraft:trapped_chest"
    tick-interval: 1      # 每tick提交（生电需要0 tick延迟）
    timeout-us: 100
    control-goal: true
    batch-size: 8
  
  # 熔炉空闲优化 / Furnace idle skip
  # 说明：空闲时跳过tick（已被v3.0包含）
  # Description: Skip tick when idle (included in v3.0)
  furnace-optimization:
    enabled: false  # 关闭（被v3.0替代）
  
  # 方块实体并行化tick / Block Entity Parallel Tick (v9.0)
  # 说明：将方块实体tick分批并行处理，参考C3H6N6O6设计
  # Description: Parallel block entity tick processing, inspired by C3H6N6O6
  # 技术特性 / Features:
  #   - 批量并行处理 / Batch parallel processing
  #   - 容器保护机制 / Container protection
  #   - Lithium睡眠方块实体兼容 / Lithium sleeping block entity compatibility
  #   - Folia区域化自动禁用 / Auto-disable in Folia regionized mode
  parallel-tick:
    # 启用开关 / Enable toggle
    # 注意：Folia/Luminol环境下会自动禁用（区域并行已优化）
    # Note: Auto-disabled in Folia/Luminol (regionized parallel already optimized)
    enabled: true
    # 最小方块实体数阈值 / Minimum block entities threshold
    # 说明：低于此值不启用并行（避免overhead）
    # Description: Skip parallel if block entities < threshold
    min-block-entities: 50
    # 批量大小 / Batch size
    # 说明：每批处理的方块实体数量
    # Description: Number of block entities per batch
    batch-size: 16
    # 容器保护 / Container protection
    # 说明：容器类方块实体（箱子、漏斗等）在主线程执行
    # Description: Container block entities (chest, hopper, etc.) tick on main thread
    # 原因：避免并发访问导致物品丢失或复制
    # Reason: Prevent item loss or duplication from concurrent access
    protect-containers: true
    # 超时时间（毫秒）/ Timeout (milliseconds)
    # 说明：并行执行超时后降级到同步执行
    # Description: Fallback to sync execution on timeout
    timeout-ms: 50

# ==========================================
# 光照优化套件 / Lighting Optimizations
# ==========================================
lighting-optimizations:
  # 异步光照 / Async lighting
  async-lighting:
    enabled: true
    # 光照线程池大小 / Lighting thread pool size
    thread-pool-size: 2
    # 批量处理阈值 / Batch threshold
    batch-threshold: 16
  
  # 光照传播队列 / Propagation queue
  propagation-queue:
    # 分层队列（Starlight核心算法）/ Layered queue (Starlight core)
    # 说明：16层队列，按光照等级0-15分层处理
    # Description: 16-layer queue, processes by light level 0-15
    use-layered-queue: true
    # 最大传播距离 / Max propagation distance
    max-propagation-distance: 15
  
  # 天空光缓存 / Skylight cache
  skylight-cache:
    enabled: true
    # 缓存有效期（毫秒）/ Cache duration (milliseconds)
    cache-duration-ms: 100
  
  # 高级优化 / Advanced optimizations
  advanced:
    # 启用去重 / Enable deduplication
    # 说明：防止同一位置重复排队
    # Description: Prevent same position from queuing multiple times
    enable-deduplication: true
    # 动态批量大小调整 / Dynamic batch adjustment
    # 说明：根据TPS自动调整批量大小
    # Description: Auto-adjust batch size based on TPS
    dynamic-batch-adjustment: true
    # 输出高级统计 / Log advanced stats
    log-advanced-stats: false

# ==========================================
# 区块Tick异步化 / Chunk Tick Async
# ==========================================
chunk-tick-async:
  # 启用开关 / Enable toggle
  enabled: false
  # 线程数 / Thread count
  # 推荐值 / Recommended: 4
  threads: 4
  # 超时时间（微秒）/ Timeout (microseconds)
  # 说明：超时立即回退主线程同步，保证最坏TPS
  # Description: Fallback to sync on timeout, ensure worst-case TPS
  timeout-us: 200

# ==========================================
# 结构查找异步化 / Structure Location Async
# ==========================================
structure-location-async:
  # 启用开关 / Enable toggle
  enabled: true
  
  # 线程池大小 / Thread pool size
  # 推荐值 / Recommended: 2-4 (结构查找CPU密集)
  threads: 3
  
  # /locate命令异步化 / Async /locate command
  locate-command:
    enabled: true
    # 搜索半径（区块）/ Search radius (chunks)
    search-radius: 100
    # 跳过已知结构 / Skip known structures
    skip-known-structures: false
  
  # 村民交易探险家地图异步化 / Async villager trade explorer maps
  villager-trade-maps:
    enabled: true
    # 支持的交易类型 / Supported trade types
    trade-types:
      - "minecraft:ocean_monument_map"    # 海底神殿地图
      - "minecraft:woodland_mansion_map"  # 林地府邸地图
      - "minecraft:buried_treasure_map"   # 埋藏宝藏地图
    # 地图生成超时（秒）/ Map generation timeout (seconds)
    generation-timeout-seconds: 30
  
  # 海豚寻宝异步化 / Async dolphin treasure hunt
  dolphin-treasure-hunt:
    enabled: true
    # 搜索半径（区块）/ Search radius (chunks)
    search-radius: 50
    # 寻宝间隔（tick）/ Hunt interval (ticks)
    hunt-interval: 100
  
  # 箱子探险地图异步化 / Async chest exploration maps
  chest-exploration-maps:
    enabled: true
    # 支持的战利品表 / Supported loot tables
    loot-tables:
      - "minecraft:chests/shipwreck_map"
      - "minecraft:chests/underwater_ruin_big"
      - "minecraft:chests/underwater_ruin_small"
    # 地图生成概率保持不变 / Keep original map generation probability
    preserve-probability: true
  
  # 算法优化配置 / Algorithm Optimization Configuration
  algorithm-optimization:
    # 启用算法优化 / Enable algorithm optimization
    enabled: true
    
    # 搜索模式 / Search pattern
    # 可选值 / Options: "spiral"(螺旋), "layered"(分层), "hybrid"(混合)
    search-pattern: "hybrid"
    
    # 启用结构缓存 / Enable structure caching
    caching:
      enabled: true
      # 缓存最大条目数 / Max cache entries
      max-size: 1000
      # 缓存过期时间（分钟）/ Cache expiration (minutes)
      expiration-minutes: 30
    
    # 启用预计算 / Enable precomputation
    precomputation:
      enabled: true
    
    # 生物群系感知搜索 / Biome-aware search
    biome-aware-search:
      enabled: true

# ==========================================
# 数据包加载优化 / DataPack Loading Optimization
# ==========================================
datapack-optimization:
  # 启用开关 / Enable toggle
  enabled: true
  
  # 文件加载线程数 / File loading threads
  # 推荐值 / Recommended: 4-8 (根据CPU核心数调整)
  file-load-threads: 4
  
  # Zip处理线程数 / Zip processing threads
  # 推荐值 / Recommended: 2-4 (I/O密集型)
  zip-process-threads: 2
  
  # 批处理大小 / Batch size
  # 说明：每批处理的文件数量，影响内存使用和性能
  # Description: Number of files per batch, affects memory usage and performance
  batch-size: 100
  
  # 缓存过期时间（分钟）/ Cache expiration (minutes)
  # 说明：文件系统和文件内容的缓存时间
  # Description: Cache time for file systems and file contents
  cache-expiration-minutes: 30
  
  # 调试模式 / Debug mode
  # 说明：启用详细的数据包加载日志
  # Description: Enable detailed datapack loading logs
  debug-enabled: false

# ==========================================
# 高级并发优化 / Advanced Concurrency Optimizations
# ==========================================
advanced-optimizations:
  # 总开关 / Master switch
  # 说明：控制所有高级并发优化的启用/禁用
  # Description: Controls enable/disable of all advanced concurrency optimizations
  enabled: true
  
  # Virtual Thread支持 / Virtual Thread support
  # 说明：Java 21+环境下使用Virtual Thread提升并发性能
  # Description: Use Virtual Threads for better concurrency on Java 21+
  # 注意：仅在Java 21+环境下有效，会自动降级到传统线程
  # Note: Only effective on Java 21+, automatically falls back to regular threads
  virtual-threads: true
  
  # 工作窃取调度器 / Work-stealing scheduler
  # 说明：使用工作窃取模式进行批量任务处理，提升多核CPU利用率
  # Description: Use work-stealing pattern for batch processing, improves multi-core utilization
  work-stealing: true
  
  # BlockPos缓存预计算 / BlockPos cache pre-computation
  # 说明：预计算常用范围的BlockPos，减少重复计算开销
  # Description: Pre-compute common BlockPos ranges to reduce calculation overhead
  blockpos-cache: true
  
  # 优化集合类 / Optimized collections
  # 说明：使用高性能集合类替代原生集合，减少内存分配和提升访问速度
  # Description: Use high-performance collections instead of native ones
  optimized-collections: true

# ==========================================
# 安全种子保护 / Secure Seed Protection
# ==========================================
# 说明：使用1024位加密种子保护世界生成，防止种子破解
# Description: Use 1024-bit encrypted seed to protect world generation from seed cracking
secure-seed:
  # 启用安全种子 / Enable secure seed
  enabled: false
  
  # 保护结构生成 / Protect structure generation
  # 说明：保护村庄、要塞、遗迹等结构的生成种子
  # Description: Protect generation seeds for villages, strongholds, monuments, etc.
  protect-structures: true
  
  # 保护矿石生成 / Protect ore generation
  # 说明：保护钻石、金矿等矿石的生成种子
  # Description: Protect generation seeds for diamonds, gold, etc.
  protect-ores: true
  
  # 保护史莱姆区块 / Protect slime chunks
  # 说明：保护史莱姆区块的生成种子
  # Description: Protect slime chunk generation seeds
  protect-slimes: true
  
  # 种子位数 / Seed bits
  # 说明：加密种子的位数，支持1024/2048/4096
  # 推荐：1024（平衡安全性和性能）
  # Description: Encrypted seed bit length, supports 1024/2048/4096
  # Recommended: 1024 (balance security and performance)
  seed-bits: 1024

# ==========================================
# 性能监控 / Performance Monitoring
# ==========================================
performance:
  # 统一调试日志开关 / Unified debug logging switch
  # 说明：控制所有模块的调试输出（TNT、结构定位、SecureSeed等）
  # Description: Controls debug output for all modules (TNT, structure location, SecureSeed, etc.)
  # 警告：会刷屏 / Warning: Console spam!
  debug-logging: false
  
  # 性能指标收集 / Metrics collection
  # 说明：显示异步任务执行时间和队列大小
  # Description: Show async task execution times and queue sizes
  enable-metrics: true

# ==========================================
# 指令配置 / Command Configuration
# ==========================================
commands:
  # /aki-reload 指令配置 / /aki-reload command configuration
  reload:
    # 启用二次确认 / Enable confirmation
    # 说明：启用后，首次执行指令会发出警告，需要再次执行才能重载
    # Description: When enabled, first execution shows warning, requires second execution to reload
    require-confirmation: true
    # 确认超时时间（秒）/ Confirmation timeout (seconds)
    # 说明：超过此时间后需要重新确认
    # Description: After this time, confirmation is reset and warning will show again
    confirmation-timeout: 30

# 提示 / Tip: 更多线程≠更好性能！从推荐值开始调整。
# More threads ≠ better performance! Start with recommended values.
