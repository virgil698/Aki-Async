<div align="center">

# ğŸš€ AkiAsync

### Comprehensive Async Optimization Plugin for Leaves Server

[![License](https://img.shields.io/badge/License-GPL--3.0-blue.svg)](LICENSE)
[![Leaves](https://img.shields.io/badge/Leaves-1.21.8+-green.svg)](https://github.com/LeavesMC/Leaves)
[![Java](https://img.shields.io/badge/Java-21+-orange.svg)](https://www.oracle.com/java/)
[![Build](https://img.shields.io/badge/build-passing-brightgreen.svg)](build/libs)
[![Version](https://img.shields.io/badge/version-1.0.0--Community-orange.svg)](https://github.com/virgil698/Aki-Async/releases)


ä¸€ä¸ªä¸“ä¸º **Leaves 1.21.8+** æœåŠ¡ç«¯è®¾è®¡çš„å…¨æ–¹ä½å¼‚æ­¥ä¼˜åŒ–æ’ä»¶  
é€šè¿‡ Mixin æŠ€æœ¯æ·±åº¦ä¼˜åŒ–æœåŠ¡ç«¯æ€§èƒ½ï¼Œè®©ä½ çš„æœåŠ¡å™¨ä¸æ»‘æµç•…

**ğŸ‰ Community Edition (å¼€æºç¤¾åŒºç‰ˆ)** - å®Œå…¨å…è´¹ï¼Œæ°¸ä¹…å¼€æº

[ç‰¹æ€§](#-æ ¸å¿ƒç‰¹æ€§) â€¢ [å®‰è£…](#-å¿«é€Ÿå¼€å§‹) â€¢ [é…ç½®](#ï¸-é…ç½®) â€¢ [æ€§èƒ½](#-æ€§èƒ½æµ‹è¯•) â€¢ [æ–‡æ¡£](docs/)

</div>

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### ğŸ“Š æ€§èƒ½è¡¨ç°

<table>
<tr>
<td>

**ä¼˜åŒ–å‰**
- MSPT: ~20-30ms
- TPSæ³¢åŠ¨: é¢‘ç¹
- CPUå ç”¨: ä¸å‡è¡¡

</td>
<td>

**ä¼˜åŒ–å** âœ¨
- **MSPT: ~9.34ms** (â†“ 74%)
- **TPS: 20.00** (ç¨³å®š)
- **CPU: 24.23%** (å¤šæ ¸å‡è¡¡)

</td>
</tr>
</table>

### ğŸš€ 19ä¸ªä¼˜åŒ–æ¨¡å—ï¼ˆ1.21.8ä¸“ç”¨ï¼‰

#### **å¼‚æ­¥AIä¼˜åŒ–** (4ä¸ªæ¨¡å—)
- âš¡ **Zero-Latency Async AI - æ‘æ°‘** - UUIDè™šæ‹Ÿå¼•ç”¨+POIå¿«ç…§+èŒä¸šåŸå­å å‘
- ğŸ· **Zero-Latency Async AI - çŒªçµ/è›®å…µ** - ç‰©å“æ¯”ä»·+ææƒ§å‘é‡+è™šæ‹Ÿå¼•ç”¨ï¼ˆNEW!ï¼‰
- ğŸ§  **Brain Throttle** - AIé™é¢‘ï¼Œé™æ­¢å®ä½“æ¯10 tickæ€è€ƒä¸€æ¬¡
- ğŸ”’ **Villager Job Claim Atomic** - æ‘æ°‘èŒä¸šåŸå­å å‘ï¼Œé˜²æ­¢çš®è‚¤æ¨ªè·³

#### **å¹¶è¡Œä¼˜åŒ–** (3ä¸ªæ¨¡å—)
- ğŸ”„ **Async Entity Tracker** - å®ä½“è¿½è¸ªå¼‚æ­¥åŒ–ï¼Œå‡å°‘ä¸»çº¿ç¨‹è´Ÿè½½
- ğŸ¯ **Parallel Entity Tickï¼ˆå®ä½“çº§åˆ†æ‰¹ï¼‰** - 8å®ä½“/æ‰¹ï¼Œè‡ªé€‚åº”è¶…æ—¶ï¼Œallofèšåˆ
- ğŸ—ºï¸ **Pathfinding Budget** - å¯»è·¯é¢„ç®—è°ƒåº¦ï¼Œå¹³æ»‘åˆ†æ•£è´Ÿè½½

#### **ç”Ÿæˆä¼˜åŒ–** (1ä¸ªæ¨¡å—)
- ğŸ› **Async Mob Spawning** - å¼‚æ­¥ç”Ÿç‰©ç”Ÿæˆï¼Œå¯†åº¦æ™ºèƒ½æ§åˆ¶

#### **å…‰ç…§ä¼˜åŒ–** (3ä¸ªæ¨¡å—)
- ğŸ’¡ **16-Layer Propagation Queue** - Starlightæ ¸å¿ƒç®—æ³•ï¼Œåˆ†å±‚å¤„ç†å…‰ç…§
- ğŸ”† **Smart Batch Adjustment** - TPSè‡ªé€‚åº”æ‰¹é‡å¤§å°ï¼ˆ8-64åŠ¨æ€è°ƒæ•´ï¼‰
- â˜€ï¸ **Skylight Cache + Deduplication** - å¤©ç©ºå…‰ç¼“å­˜ + å»é‡ï¼ˆ+30%æ•ˆç‡ï¼‰

#### **æ€§èƒ½ä¼˜åŒ–** (ServerCore-inspired, 3ä¸ªæ¨¡å—)
- ğŸ’¥ **Push Optimization** - æ¨æŒ¤ä¼˜åŒ–ï¼ˆ26.72%çƒ­ç‚¹ï¼‰
- ğŸ” **Entity Lookup Cache** - å®ä½“æŸ¥æ‰¾ç¼“å­˜ï¼ˆ23.12%çƒ­ç‚¹ï¼‰
- ğŸ² **Collision Optimization** - ç¢°æ’æ£€æµ‹ä¼˜åŒ–ï¼ˆ9%çƒ­ç‚¹ï¼‰

#### **å†…å­˜ä¼˜åŒ–** (FerriteCore-inspired, 3ä¸ªæ¨¡å—)
- ğŸ—„ï¸ **BlockPos Pooling** - å¯¹è±¡æ± å‡å°‘26%å†…å­˜åˆ†é…
- ğŸ“¦ **Predicate Cache** - è°“è¯ç¼“å­˜ï¼Œé™ä½GCå‹åŠ›
- ğŸ“‹ **List Pre-allocation** - åˆ—è¡¨é¢„åˆ†é…ï¼Œå‡å°‘ArrayListæ‰©å®¹

### ğŸ¨ æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            AkiAsync Plugin Core (v1.0.0)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ General Pool â”‚  â”‚  Lighting Pool  â”‚         â”‚
â”‚  â”‚  (4 threads) â”‚  â”‚   (2 threads)   â”‚         â”‚
â”‚  â”‚ AI + Entity  â”‚  â”‚   Light Only    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Bridge Pattern (Mixin â†” Plugin)         â”‚
â”‚         UUIDè™šæ‹Ÿå¼•ç”¨ + ExpirableValueæ—¶é—´æ ¡æ­£     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  19 Optimization Mixins (Priority 999-1200)     â”‚
â”‚  - Async AI (4)        - Parallel (3)           â”‚
â”‚  - Lighting (3)        - Performance (3)        â”‚
â”‚  - Memory (3)          - Spawning (1)           â”‚
â”‚  - Brain Throttle (1)  - Pathfinding (1)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ† å…³é”®æŠ€æœ¯

- **UUIDè™šæ‹Ÿå¼•ç”¨** - å¼‚æ­¥å­˜UUIDï¼Œä¸»çº¿ç¨‹æŸ¥ç©å®¶ï¼ˆé¿å…è·¨çº¿ç¨‹ä¼ Playerï¼‰
- **ExpirableValueå¤„ç†** - é¿å…ç±»å‹é”™è¯¯ï¼ˆä¹‹å‰ä¼šå´©ï¼‰
- **å®ä½“çº§åˆ†æ‰¹** - 8ä¸ªä¸€æ‰¹ï¼Œä»»åŠ¡å‡è¡¡
- **è‡ªé€‚åº”è¶…æ—¶** - æ ¹æ®MSPTè°ƒæ•´ï¼ˆ25-100msï¼‰
- **åŸå­å å‘** - æ‘æ°‘èŒä¸šç”³è¯·åŠ é”ï¼ˆé˜²æ­¢çš®è‚¤è·³ï¼‰
- **åŒçº¿ç¨‹æ± ** - General + Lightingåˆ†å¼€
- **100Î¼sè¶…æ—¶** - è¶…æ—¶ç«‹å³fallback

---

## âœ¨ è¯¦ç»†ç‰¹æ€§

<details>
<summary><b>ğŸ”„ å¼‚æ­¥å®ä½“è¿½è¸ªå™¨ (Async Entity Tracker)</b></summary>

- å°†å®ä½“ä½ç½®æ›´æ–°è®¡ç®—ç§»è‡³å¼‚æ­¥çº¿ç¨‹
- å¼‚æ­¥å¤„ç†ç©å®¶è§†è·å†…çš„å®ä½“å¯è§æ€§æ£€æŸ¥
- ä½ç½®é¢„æµ‹å’Œè¾¹ç¼˜æ£€æµ‹ä¼˜åŒ–
- æ™ºèƒ½å¤„ç†ï¼šç©å®¶å®ä½“ä¿æŒåŒæ­¥ç¡®ä¿å“åº”é€Ÿåº¦

</details>

<details>
<summary><b>ğŸ¯ å¹¶è¡Œå®ä½“Tickï¼ˆå®ä½“çº§åˆ†æ‰¹ï¼‰</b> - 76%çƒ­ç‚¹ä¼˜åŒ–ï¼Œæ‰©å®¹å‡çº§ç‰ˆ</summary>

**åšäº†ä»€ä¹ˆ**ï¼š
- æŠŠchunkçº§åˆ†ç»„æ”¹æˆå®ä½“çº§åˆ†æ‰¹ï¼ˆ8ä¸ªå®ä½“ä¸€æ‰¹ï¼‰
- é¿å…æŸä¸ªchunkæœ‰150ä¸ªå®ä½“ï¼Œå…¶ä»–chunkåªæœ‰å‡ ä¸ªçš„æƒ…å†µ
- è¶…æ—¶æ—¶é—´æ ¹æ®MSPTè‡ªåŠ¨è°ƒæ•´ï¼ˆ25-100msï¼‰
- ç”¨CompletableFuture.allOfç­‰æ‰€æœ‰æ‰¹æ¬¡éƒ½å®Œæˆ

**æ”¹è¿›ç‚¹**ï¼š
- ä»»åŠ¡å¤§å°å‡è¡¡ï¼ˆæ¯æ‰¹å›ºå®š8ä¸ªå®ä½“ï¼‰
- æ²¡æœ‰é•¿å°¾ä»»åŠ¡æ‹–æ…¢æ•´ä½“
- ä¸å’Œå…¶ä»–å¼‚æ­¥ä»»åŠ¡æŠ¢çº¿ç¨‹æ± 

**æ•ˆæœ**ï¼š
- MSPTä»14.6ms â†’ 9.34msï¼ˆå†é™36%ï¼‰
- é…ç½®batch-sizeå¯è°ƒï¼ˆé»˜è®¤8ï¼‰

</details>

<details>
<summary><b>ğŸ’¡ å¢å¼ºç‰ˆå¼‚æ­¥å…‰ç…§ (Enhanced Async Lighting)</b> - Starlightç®—æ³•</summary>

**åŸºç¡€ä¼˜åŒ–**ï¼š
- åŒºå—åŠ è½½æ—¶çš„å¼‚æ­¥å…‰ç…§è®¡ç®—
- å…‰ç…§æ›´æ–°æ‰¹é‡å¤„ç†ï¼ˆå‡å°‘çº¿ç¨‹å¼€é”€ï¼‰
- å¤©ç©ºå…‰ç¼“å­˜ï¼ˆé¿å…é‡å¤è®¡ç®—ï¼‰
- ä¸“ç”¨å…‰ç…§çº¿ç¨‹æ± ï¼ˆ2çº¿ç¨‹é»˜è®¤ï¼‰

**é«˜çº§ä¼˜åŒ–** â­ï¼š
- **çœŸæ­£çš„16å±‚åˆ†å±‚ä¼ æ’­é˜Ÿåˆ—** - Starlightæ ¸å¿ƒç®—æ³•ï¼ˆå…‰ç…§ç­‰çº§0-15ï¼‰
- **æ™ºèƒ½æ‰¹é‡å¤§å°è°ƒæ•´** - æ ¹æ®TPSåŠ¨æ€è°ƒæ•´ï¼ˆ8-64èŒƒå›´ï¼‰
- **å…‰ç…§æ›´æ–°å»é‡** - é˜²æ­¢é‡å¤è®¡ç®—ï¼Œæå‡30%æ•ˆç‡
- **ä¼ æ’­è·ç¦»é™åˆ¶** - é˜²æ­¢è¿‡æœŸæ›´æ–°ï¼Œ5ç§’è¶…æ—¶æ¸…ç†

</details>

<details>
<summary><b>âš¡ é›¶å»¶è¿Ÿå¼‚æ­¥AI - æ‘æ°‘</b></summary>

**åšäº†ä»€ä¹ˆ**ï¼š
- æŠŠæ‘æ°‘æ‰¾å·¥ä½œç«™ã€æ‰¾åºŠä½çš„POIæŸ¥è¯¢æ”¾åˆ°å¼‚æ­¥çº¿ç¨‹
- ä¸»çº¿ç¨‹åªæ‹ä¸ªå¿«ç…§ï¼Œå¼‚æ­¥çº¿ç¨‹ç®—å®Œäº†å†å†™å›
- åŒä¸€tickå†…å®Œæˆï¼Œæ‘æ°‘è¡Œä¸ºçœ‹ä¸å‡ºåŒºåˆ«

**æŠ€æœ¯è¦ç‚¹**ï¼š
- POIå¿«ç…§ï¼ˆä¸å¯å˜Mapï¼Œçº¿ç¨‹å®‰å…¨ï¼‰
- å¼‚æ­¥ç®—64ä¸ªPOIçš„è·ç¦»è¯„åˆ†
- ExpirableValueç±»å‹å¤„ç†ï¼ˆé¿å…ClassCastExceptionï¼‰
- èŒä¸šç”³è¯·åŠ åŸå­é”ï¼ˆé˜²æ­¢æ‘æ°‘çš®è‚¤æ¥å›è·³ï¼‰

**æ•ˆæœï¼ˆ44æ‘æ°‘æµ‹è¯•ï¼‰**ï¼š
- MSPTï¼š36ms â†’ 14.6msï¼ˆé™ä½60%ï¼‰
- æ‘æ°‘èŒä¸šç¨³å®šï¼ˆä¸å†ç²’å­å‡ºç°äº†ä½†çš®è‚¤ä¸å˜ï¼‰
- äº¤æ˜“æ­£å¸¸ï¼Œä¸æ‘‡å¤´

**é…ç½®**ï¼š
```yaml
villager-optimization:
  enabled: true
  use-poi-snapshot: true
```

</details>

<details>
<summary><b>ğŸ· é›¶å»¶è¿Ÿå¼‚æ­¥AI - çŒªçµ/è›®å…µ</b></summary>

**æ”¯æŒ**ï¼šçŒªçµ + çŒªçµè›®å…µ

**åšäº†ä»€ä¹ˆ**ï¼š
- æŠŠé‡‘å¸æ£€æµ‹ã€ç‰©å“æ¯”ä»·ã€ææƒ§å‘é‡è®¡ç®—æ”¾åˆ°å¼‚æ­¥çº¿ç¨‹
- ä¸»çº¿ç¨‹åªåšæœ€åçš„å†™å›ï¼ˆ< 0.1msï¼‰
- 3 tickæ‰§è¡Œä¸€æ¬¡ï¼ˆæ¯”æ‘æ°‘ç¨€ç–ï¼Œé¿å…è¿‡è½½ï¼‰

**æŠ€æœ¯è¦ç‚¹**ï¼š
- å¼‚æ­¥é˜¶æ®µå­˜UUIDï¼ˆä¸å­˜Playerå¼•ç”¨ï¼Œé¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼‰
- ä¸»çº¿ç¨‹ç”¨UUIDæŸ¥ç©å®¶ï¼Œå†æ£€æŸ¥è·ç¦»å’Œæ˜¯å¦æŒé‡‘
- é˜²æ­¢ç©å®¶ä¸‹çº¿å¯¼è‡´NPE

**æ•ˆæœ**ï¼š
- 50åªçŒªçµåŸæœ¬åƒæ‰2ä¸ªTPS
- ä¼˜åŒ–åä¸å½±å“TPS
- çŒªçµè¡Œä¸ºæ­£å¸¸ï¼ˆå¯»è·¯ã€äº¤æ˜“ã€é€ƒè·‘ï¼‰

**é…ç½®**ï¼š
```yaml
piglin-optimization:
  enabled: false  # éœ€è¦æ—¶å†å¼€
  look-distance: 16  # å¯è°ƒå°ï¼ˆ10/12ï¼‰é¿å…å¡é¡¿
```

</details>

<details>
<summary><b>ğŸ§  AI Brain é™é¢‘ (Brain Throttle)</b></summary>

- é™æ­¢å®ä½“åœ¨å¯é…ç½®é—´éš”å†…è·³è¿‡ `Brain#tick`
- äº‹ä»¶å‘ç”Ÿç«‹å³æ¢å¤æ­£å¸¸é¢‘ç‡
- å¯¹ä½æ´»è·ƒåº¦å®ä½“é™ä½AIè®¡ç®—é¢‘ç‡
- å¯é…ç½®é™é¢‘é—´éš”ï¼ˆé»˜è®¤10 tickï¼‰

</details>

<details>
<summary><b>ğŸ—ºï¸ å¯»è·¯é¢„ç®—è°ƒåº¦ (Pathfinding Budget)</b></summary>

- ä¸º `PathNavigation#createPath` è®¾ç½®æ¯tické¢„ç®—
- è¶…å‡ºé¢„ç®—çš„è¯·æ±‚åŠ å…¥å»¶è¿Ÿé˜Ÿåˆ—
- å¹³æ»‘åˆ†æ•£è´Ÿè½½ï¼Œé¿å…å•tickå¯»è·¯çˆ†ç‚¸
- å»¶è¿Ÿé˜Ÿåˆ—è‡ªåŠ¨åœ¨ä¸‹ä¸€tickå¤„ç†

</details>

<details>
<summary><b>ğŸ› å¼‚æ­¥ç”Ÿç‰©ç”Ÿæˆ (Async Mob Spawning)</b></summary>

- åœ¨ NaturalSpawner è°ƒç”¨ç‚¹é™æµ
- åŒºå—å¯†åº¦é˜ˆå€¼æ§åˆ¶
- Spawner æ–¹å—ä¼˜åŒ–
- é¢„è®¡ç®—ä¸ç¼“å­˜ç”Ÿæˆæ¡ä»¶

</details>

<details>
<summary><b>ğŸ’¥ ServerCore æ€§èƒ½ä¼˜åŒ–å¥—ä»¶</b></summary>

- **Push Optimization** (26.72%çƒ­ç‚¹) - æ¨æŒ¤é—´éš”æ§åˆ¶
- **Entity Lookup Cache** (23.12%çƒ­ç‚¹) - æŸ¥æ‰¾ç»“æœç¼“å­˜50ms
- **Collision Optimization** (9%çƒ­ç‚¹) - é™æ­¢å®ä½“è·³è¿‡ç¢°æ’æ£€æµ‹

</details>

<details>
<summary><b>ğŸ—„ï¸ FerriteCore å†…å­˜ä¼˜åŒ–å¥—ä»¶</b></summary>

- **BlockPos Pooling** - å¯¹è±¡æ± å‡å°‘26%å†…å­˜åˆ†é…
- **Predicate Cache** - è°“è¯ç¼“å­˜é™ä½GCå‹åŠ›
- **List Pre-allocation** - å‡å°‘ArrayListæ‰©å®¹å¼€é”€

</details>

---

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

| ç»„ä»¶ | è¦æ±‚ |
|------|------|
| **æœåŠ¡ç«¯** | [Leaves](https://github.com/LeavesMC/Leaves) 1.21.8+ |
| **JDK** | Java 21 æˆ–æ›´é«˜ç‰ˆæœ¬ |
| **å†…å­˜** | æ¨è 4GB+ |
| **CPU** | æ¨è 4æ ¸å¿ƒ+ (æ”¯æŒå¤šçº¿ç¨‹) |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼1ï¼šä¸‹è½½ Releaseï¼ˆæ¨èï¼‰

```bash
# 1. ä¸‹è½½æœ€æ–°ç‰ˆæœ¬
wget https://github.com/virgil698/Aki-Async/releases/latest/download/Aki-Async.jar

# 2. æ”¾å…¥ plugins æ–‡ä»¶å¤¹
mv Aki-Async.jar /path/to/server/plugins/

# 3. ä¿®æ”¹å¯åŠ¨è„šæœ¬æ·»åŠ  Mixin æ”¯æŒ
java -Dleavesclip.enable.mixin=true -Xms4G -Xmx4G -jar leaves.jar

# 4. é‡å¯æœåŠ¡å™¨
```

### æ–¹å¼2ï¼šä»æºç æ„å»º

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/virgil698/Aki-Async.git
cd Aki-Async

# 2. æ„å»º
./gradlew clean build

# 3. JAR æ–‡ä»¶ä½äº build/libs/Aki-Async-1.0.0-SNAPSHOT.jar
```

### âš™ï¸ å¯åŠ¨å‚æ•°ï¼ˆé‡è¦ï¼ï¼‰

```bash
# å¿…é¡»æ·»åŠ æ­¤å‚æ•°å¯ç”¨ Mixin æ”¯æŒ
-Dleavesclip.enable.mixin=true
```

## âš™ï¸ é…ç½®

é…ç½®æ–‡ä»¶ä½äº `plugins/AkiAsync/config.yml`ï¼Œé¦–æ¬¡å¯åŠ¨è‡ªåŠ¨ç”Ÿæˆã€‚

### æ¨èé…ç½®ï¼ˆä¸åŒæœåŠ¡å™¨è§„æ¨¡ï¼‰

<details>
<summary><b>å°å‹æœåŠ¡å™¨ (1-10äºº)</b></summary>

```yaml
entity-tracker:
  thread-pool-size: 2-4
  
entity-tick-parallel:
  threads: 4
  min-entities: 100

lighting-optimizations:
  async-lighting:
    thread-pool-size: 2
    batch-threshold: 16
```
</details>

<details>
<summary><b>ä¸­å‹æœåŠ¡å™¨ (10-50äºº) - æ¨èé…ç½®</b></summary>

```yaml
entity-tracker:
  enabled: true
  thread-pool-size: 4-6
  
entity-tick-parallel:
  enabled: true
  threads: 6-8
  min-entities: 50
  
brain:
  throttle: true
  throttle-interval: 10

async-ai:  # âš¡ é›¶å»¶è¿Ÿå¼‚æ­¥AIï¼ˆ1.21.8ä¸“ç”¨ï¼‰
  timeout-microseconds: 100  # 100å¾®ç§’è¶…æ—¶
  
  villager-optimization:  # æ‘æ°‘ä¼˜åŒ–ï¼ˆå·²ç¨³å®šï¼‰
    enabled: true  # å¯å¯ç”¨
    use-poi-snapshot: true
  
  piglin-optimization:  # çŒªçµ+è›®å…µä¼˜åŒ–ï¼ˆNEW!ï¼‰
    enabled: true  # å¯å¯ç”¨
    use-poi-snapshot: false
    look-distance: 16  # å¯è°ƒ 10/12/16
    barter-distance: 16

entity-tick-parallel:  # å®ä½“çº§åˆ†æ‰¹å¹¶è¡Œ
  enabled: true
  threads: 6-8
  min-entities: 50
  batch-size: 8  # NEW! 8å®ä½“/æ‰¹

lighting-optimizations:
  async-lighting:
    enabled: true
    thread-pool-size: 2-3
    batch-threshold: 16
  propagation-queue:
    use-layered-queue: true  # â­ 16å±‚é˜Ÿåˆ—
  advanced:
    enable-deduplication: true
    dynamic-batch-adjustment: true
```
</details>

<details>
<summary><b>å¤§å‹æœåŠ¡å™¨ (50+äºº)</b></summary>

```yaml
entity-tracker:
  thread-pool-size: 8
  
entity-tick-parallel:
  threads: 8-12
  min-entities: 50
  
brain:
  throttle-interval: 15  # æ›´æ¿€è¿›çš„é™é¢‘

lighting-optimizations:
  async-lighting:
    thread-pool-size: 3-4
    batch-threshold: 24
```
</details>

### æ ¸å¿ƒé…ç½®é¡¹è¯´æ˜

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `entity-tracker.thread-pool-size` | 4 | å¼‚æ­¥çº¿ç¨‹æ± å¤§å° |
| `entity-tick-parallel.threads` | 6 | å¹¶è¡Œå®ä½“Tickçº¿ç¨‹æ•° |
| `entity-tick-parallel.batch-size` | 8 | å®ä½“çº§åˆ†æ‰¹å¤§å°ï¼ˆNEW!ï¼‰âš¡ |
| `brain.throttle-interval` | 10 | AIé™é¢‘é—´éš”ï¼ˆtickï¼‰ |
| `async-ai.villager-optimization.enabled` | false | æ‘æ°‘å¼‚æ­¥AIï¼ˆå·²ç¨³å®šï¼‰âš¡ |
| `async-ai.piglin-optimization.enabled` | false | çŒªçµå¼‚æ­¥AIï¼ˆNEW!ï¼‰ğŸ· |
| `async-ai.timeout-microseconds` | 100 | AIæ‰§è¡Œè¶…æ—¶ï¼ˆå¾®ç§’ï¼‰|
| `lighting-optimizations.async-lighting.batch-threshold` | 16 | å…‰ç…§æ‰¹é‡å¤„ç†é˜ˆå€¼ |
| `pathfinding.tick-budget` | 0 | å¯»è·¯é¢„ç®—ï¼ˆ0=ç¦ç”¨ï¼‰ |

## ğŸ“Š æ€§èƒ½æµ‹è¯•

### å®æµ‹æ•°æ®ï¼ˆå¼€å‘è€…æœ¬åœ°æµ‹è¯•æœåŠ¡å™¨ï¼‰

**æµ‹è¯•ç¯å¢ƒ**ï¼š
- CPU: Intel Core Ultra 5 125H (18 threads)
- Server: Leaves 1.21.8-137
- Players: 1 online  
- Entities: 147æ€»è®¡ï¼ˆ44æ‘æ°‘ + 49çŒªçµ/è›®å…µ + å…¶ä»–ï¼‰

**æ€§èƒ½æŒ‡æ ‡ï¼ˆå®æµ‹æ•°æ® - Spark 5åˆ†é’Ÿé‡‡æ ·ï¼‰**ï¼š

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| **MSPT (æœ€å°å€¼)** | ~14.8ms | **4.58ms** | â†“ 69% |
| **MSPT (ä¸­ä½æ•°)** | ~36ms | **9.34ms** | â†“ 74% |
| **MSPT (95åˆ†ä½)** | ~54ms | **19.6ms** | â†“ 64% |
| **TPS** | 19.95 | **20.00** | ç¨³å®šæ»¡TPS |
| **CPUå ç”¨ï¼ˆç³»ç»Ÿï¼‰** | å•æ ¸é«˜è´Ÿè½½ | **24.23%** | å¤šæ ¸å‡è¡¡ |
| **GC (G1 Young)** | é¢‘ç¹ | **4.4ms** | ä½å»¶è¿Ÿ |

**åˆ†æ¨¡å—æ€§èƒ½è´¡çŒ®**ï¼š
- å¹¶è¡Œå®ä½“Tickï¼ˆå®ä½“çº§åˆ†æ‰¹ï¼‰ï¼š~40%ï¼ˆä¸»åŠ›ï¼‰
- é›¶å»¶è¿Ÿå¼‚æ­¥AIï¼ˆæ‘æ°‘ï¼‰ï¼š~25%
- é›¶å»¶è¿Ÿå¼‚æ­¥AIï¼ˆçŒªçµ/è›®å…µï¼‰ï¼š~15%
- å…¶ä»–ä¼˜åŒ–ï¼ˆå…‰ç…§/å†…å­˜/æ€§èƒ½ï¼‰ï¼š~20%

---

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ„å»ºé¡¹ç›®

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/virgil698/Aki-Async.git
cd Aki-Async

# æ„å»º
./gradlew clean build

# æ„å»ºäº§ç‰©
# build/libs/Aki-Async-1.0.0-SNAPSHOT.jar
```

### é¡¹ç›®ç»“æ„

```
Aki-Async/
â”œâ”€â”€ src/main/                 # æ’ä»¶ä¸»ä»£ç 
â”‚   â”œâ”€â”€ java/org/virgil/akiasync/
â”‚   â”‚   â”œâ”€â”€ AkiAsyncPlugin.java          # æ’ä»¶å…¥å£
â”‚   â”‚   â”œâ”€â”€ bridge/AkiAsyncBridge.java   # Bridgeå®ç°
â”‚   â”‚   â”œâ”€â”€ config/ConfigManager.java    # é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ executor/AsyncExecutorManager.java  # çº¿ç¨‹æ± ç®¡ç†
â”‚   â””â”€â”€ resources/config.yml
â”‚
â”œâ”€â”€ src/mixin/                # Mixinä»£ç 
â”‚   â”œâ”€â”€ java/org/virgil/akiasync/mixin/
â”‚   â”‚   â”œâ”€â”€ bridge/                # Bridgeæ¥å£
â”‚   â”‚   â””â”€â”€ mixins/
â”‚   â”‚       â”œâ”€â”€ entity/            # å®ä½“ä¼˜åŒ– (5ä¸ª)
â”‚   â”‚       â”œâ”€â”€ lighting/          # å…‰ç…§ä¼˜åŒ– (3ä¸ª)
â”‚   â”‚       â”œâ”€â”€ memory/            # å†…å­˜ä¼˜åŒ– (3ä¸ª)
â”‚   â”‚       â”œâ”€â”€ brain/             # AIä¼˜åŒ–
â”‚   â”‚       â”œâ”€â”€ pathfinding/       # å¯»è·¯ä¼˜åŒ–
â”‚   â”‚       â””â”€â”€ spawning/          # ç”Ÿæˆä¼˜åŒ–
â”‚   â””â”€â”€ resources/
â”‚       â”œâ”€â”€ aki-async.mixins.json
â”‚       â””â”€â”€ aki-async.accesswidener
â”‚
â”œâ”€â”€ docs/                     # æ–‡æ¡£
â”‚   â””â”€â”€ REFERENCE_MODS.md    # å‚è€ƒé¡¹ç›®æ¸…å•
â””â”€â”€ build.gradle.kts
```

## ğŸ“š å‚è€ƒä¸è‡´è°¢

æœ¬é¡¹ç›®å‚è€ƒäº†å¤šä¸ªä¼˜ç§€çš„å¼€æºé¡¹ç›®ï¼š

| é¡¹ç›® | è´¡çŒ® |
|------|------|
| [Starlight](https://github.com/PaperMC/Starlight) / [ScalableLux](https://github.com/RelativityMC/ScalableLux) | 16å±‚å…‰ç…§ä¼ æ’­é˜Ÿåˆ—æ ¸å¿ƒç®—æ³• |
| [Lithium](https://github.com/CaffeineMC/lithium) | é€šç”¨æ€§èƒ½ä¼˜åŒ–æ€è·¯ |
| [ServerCore](https://github.com/Wesley1808/ServerCore) | Push/Collision/Lookupä¼˜åŒ– |
| [FerriteCore](https://github.com/malte0811/FerriteCore) | å†…å­˜ä¼˜åŒ–ç­–ç•¥ |
| [Nitori](https://github.com/Gensokyo-Reimagined/Nitori) | å®ä½“è¿½è¸ªå™¨è®¾è®¡ |
| [Async](https://github.com/AxalotLDev/Async) | å¼‚æ­¥åŒ–å®‰å…¨è¾¹ç•Œ |
| [Leaves](https://github.com/LeavesMC/Leaves) | Mixinæ”¯æŒå’ŒæœåŠ¡ç«¯åŸºç¡€ |

è¯¦è§ [REFERENCE_MODS.md](docs/REFERENCE_MODS.md)

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

<details>
<summary><b>Q: æ’ä»¶æ— æ³•åŠ è½½ï¼Ÿ</b></summary>

æ£€æŸ¥å¯åŠ¨å‚æ•°æ˜¯å¦åŒ…å« `-Dleavesclip.enable.mixin=true`

</details>

<details>
<summary><b>Q: MSPT æ²¡æœ‰æ˜æ˜¾æ”¹å–„ï¼Ÿ</b></summary>

1. ç¡®è®¤å®ä½“æ•°é‡ > 50ï¼ˆå°‘äº50ä¸ä¼šå¯ç”¨å¹¶è¡Œä¼˜åŒ–ï¼‰
2. è°ƒæ•´ `entity-tick-parallel.threads` ä¸ºCPUæ ¸å¿ƒæ•°çš„1.5å€
3. å¯ç”¨ `performance.enable-metrics` æŸ¥çœ‹è¯¦ç»†ç»Ÿè®¡

</details>

<details>
<summary><b>Q: å…‰ç…§å¼‚å¸¸æˆ–åŒºå—é»‘æš—ï¼Ÿ</b></summary>

ä¸´æ—¶ç¦ç”¨å…‰ç…§ä¼˜åŒ–ï¼š
```yaml
lighting-optimizations:
  async-lighting:
    enabled: false
```

</details>

<details>
<summary><b>Q: å¦‚ä½•æŸ¥çœ‹ä¼˜åŒ–æ•ˆæœï¼Ÿ</b></summary>

ä½¿ç”¨ [Spark](https://spark.lucko.me/) æ€§èƒ½åˆ†æå·¥å…·ï¼š
```
/spark profiler start
# è¿è¡Œä¸€æ®µæ—¶é—´å
/spark profiler stop
```

</details>

<details>
<summary><b>Q: å¦‚ä½•å¯ç”¨é›¶å»¶è¿Ÿå¼‚æ­¥AIï¼Ÿâš¡ NEW!</b></summary>

**æ‘æ°‘ä¼˜åŒ–**ï¼š
```yaml
async-ai:
  villager-optimization:
    enabled: true
```

**çŒªçµä¼˜åŒ–**ï¼š
```yaml
async-ai:
  piglin-optimization:
    enabled: true
    look-distance: 16  # çŒªçµå¤ªå¤šå¡å¯ä»¥æ”¹å°
```

**éªŒè¯**ï¼š
- è§‚å¯Ÿæ§åˆ¶å°æœ‰æ²¡æœ‰æŠ¥é”™
- æ‘æ°‘æ‰¾å·¥ä½œç«™æ˜¯å¦æ­£å¸¸
- çŒªçµçœ‹åˆ°é‡‘é”­æ˜¯å¦ä¼šè¿½
- /spark tps çœ‹MSPTæ˜¯å¦ â‰¤ 10ms

</details>

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

**å¼€å‘æŒ‡å—**ï¼š
1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ï¼ˆä½¿ç”¨[çº¦å®šå¼æäº¤](https://www.conventionalcommits.org/zh-hans/)ï¼‰
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. å¼€å¯ Pull Request

### æäº¤è§„èŒƒ

```bash
feat(module): add new optimization
fix(lighting): resolve chunk loading issue
perf(entity): improve parallel processing
docs: update configuration guide
```

---

## âš ï¸ å…è´£å£°æ˜

- âš ï¸ æœ¬æ’ä»¶é€šè¿‡ Mixin ä¿®æ”¹æœåŠ¡ç«¯æ ¸å¿ƒä»£ç ï¼Œ**è¯·åœ¨æµ‹è¯•æœåŠ¡å™¨å……åˆ†éªŒè¯åå†ç”¨äºç”Ÿäº§**
- âš ï¸ ä¸ä¿è¯ä¸æ‰€æœ‰æ’ä»¶100%å…¼å®¹ï¼ˆç‰¹åˆ«æ˜¯å…¶ä»–Mixinæ’ä»¶ï¼‰
- âš ï¸ å¦‚é‡é—®é¢˜è¯·å…ˆç¦ç”¨æ’ä»¶ï¼Œç„¶åæäº¤ [Issue](https://github.com/virgil698/Aki-Async/issues)
- âœ… å·²åœ¨ç”Ÿäº§ç¯å¢ƒéªŒè¯ç¨³å®šæ€§ï¼ˆ1400+å®ä½“åœºæ™¯ï¼‰

## ğŸ“„ å¼€æºåè®®

æœ¬é¡¹ç›®é‡‡ç”¨ **[GPL-3.0 License](LICENSE)** å¼€æºåè®®ã€‚

### ğŸ†“ ç¤¾åŒºç‰ˆè¯´æ˜

è¿™æ˜¯ **AkiAsync Community Editionï¼ˆç¤¾åŒºç‰ˆï¼‰**ï¼š
- âœ… å®Œå…¨å…è´¹ä½¿ç”¨
- âœ… æºä»£ç å¼€æ”¾
- âœ… å…è®¸å•†ä¸šä½¿ç”¨
- âœ… 19ä¸ªä¼˜åŒ–æ¨¡å—ï¼ˆ4ä¸ªé›¶å»¶è¿Ÿå¼‚æ­¥AIä¸“é¡¹ï¼‰
- âœ… ç¤¾åŒºæ”¯æŒ

æ ¹æ®GPL-3.0åè®®ï¼Œä½ å¯ä»¥ï¼š
- âœ… è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹ã€åˆ†å‘
- âœ… ç”¨äºå•†ä¸šæœåŠ¡å™¨
- âš ï¸ ä¿®æ”¹åçš„ç‰ˆæœ¬å¿…é¡»åŒæ ·å¼€æºï¼ˆGPL-3.0ï¼‰
- âš ï¸ å¿…é¡»ä¿ç•™ç‰ˆæƒå£°æ˜

---

## â­ Star History

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ Star æ”¯æŒä¸€ä¸‹ï¼

---

<div align="center">

### ğŸ¯ é¡¹ç›®çŠ¶æ€

**Edition**: Community (å¼€æºç‰ˆ) | **Status**: âœ… Production Ready | **Version**: 1.0.0 | **Modules**: 19

**Author**: [Virgil](https://github.com/virgil698)   
**License**: GPL-3.0  
**Supported**: Leaves 1.21.8+

---

### ğŸŒŸ ç‰¹åˆ«è‡´è°¢

æ„Ÿè°¢ [Leaves å›¢é˜Ÿ](https://github.com/LeavesMC/Leaves) æä¾›ä¼˜ç§€çš„æœåŠ¡ç«¯  
æ„Ÿè°¢æ‰€æœ‰å‚è€ƒé¡¹ç›®çš„å¼€å‘è€…ä»¬  
æ„Ÿè°¢ Fabric/Sponge å›¢é˜Ÿçš„ Mixin æŠ€æœ¯

---

**å¦‚æœè§‰å¾—æœ‰ç”¨ï¼Œè¯·è€ƒè™‘ Star â­ æ”¯æŒå¼€å‘ï¼**

---

### ğŸ“® è”ç³»ä¸æ”¯æŒ

- ğŸ’¬ **Issues**: [GitHub Issues](https://github.com/virgil698/Aki-Async/issues)
- ğŸ“§ **Email**: virgil698@sky233.top
- ğŸ’¬ **Discord**: xiaokou23357(virgil698)

---

Made with â¤ï¸ for Minecraft Server Optimization | Licensed under GPL-3.0

</div>
